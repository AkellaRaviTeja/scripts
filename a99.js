!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("blueimp-md5")):"function"==typeof define&&define.amd?define(["blueimp-md5"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).Apxor=t(e.md5)}(this,function(e){"use strict";function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function n(e){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?t(Object(i),!0).forEach(function(t){a(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):t(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,g(i.key),i)}}function s(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function a(e,t,n){return(t=g(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,o,s,a=[],u=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(i=o.call(n)).done)&&(a.push(i.value),a.length!==t);u=!0);}catch(e){c=!0,r=e}finally{try{if(!u&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw r}}return a}}(e,t)||l(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e){return function(e){if(Array.isArray(e))return d(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||l(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){if(e){if("string"==typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(e,t):void 0}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function g(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}var f={enable:!0,api_root:"https://server.apxor.com/v2/api",auto_track_events:["click","submit"],cookie_expiration:730,name:"",domain:"",cookie_prefix:"_apx_",idle_time_out:1800,ed_t_time:-1,sct_time:108e5,events:{stop:[],action:[]}},h={debug:!1,honorDNT:!1,idle_time_out:1800,client_id:null,session_id:null,plugins:[],version:"ALL",events_upload_time:-1,retry_time:-1,bulk_upload:!0},v="Opera Mini",p="Opera",m="BlackBerry",_="Internet Explorer Mobile",w="Microsoft Edge",b="Facebook Mobile",y="Chrome",S="Chrome iOS",I="UC Browser",O="Firefox iOS",C="Mobile Safari",x="Safari",E="Android Mobile",k="Konqueror",T="Firefox",N="Internet Explorer",A="Mozilla",M="apx_id",D="_apx_config",J="_apx_ua",P="_apx_sc",j="_apx_ledt",L="_apx_lef",W="_apx_ch",q="_apx_lct",R="_apx_uih",B="apx_in",F="apx_ver",U="apx_lbgt",G="visible",z="APX_PAGE_OPENED",K="apx_app_opened",H="SYSTEM_EVENT",X="NAVIGATION_EVENT",Y="APP_EVENT",V="CLIENT_EVENT",Z="apx_retained_session",Q="qe_state",$="_apx_lEt",ee="_apx_sId",te="_apx_cd",ne="_apx_od",ie="_apx_lt_count",re="_apx_use",oe="_apx_scnm",se="apx_sst",ae=s(function e(){r(this,e)});a(ae,"isCookieAvailable",function(){try{var e=(new Date).getTime()+864e5;document.cookie="cookie_set=cookie_value; expires="+e;for(var t=document.cookie.split(";"),n=0;n<t.length;n++){if(-1!==t[n].indexOf("cookie_set"))return document.cookie="cookie_set=cookie_value; expires=Thu, 01 Jan 1970 00:00:01 GMT;",!0}return!1}catch(e){return!1}}),a(ae,"get",function(e){if(window.document)for(var t=e+"=",n=window.document.cookie.split(";"),i=0;i<n.length;i++){for(var r=n[i];" "===r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(t))return decodeURIComponent(r.substring(t.length,r.length))}return null});var ue,ce,le,de,ge=function(e){return void 0===e},fe=function(e){return null===e},he=function(e){return void 0!==e&&!fe(e)},ve=function(e){return!he(e)},pe=function(e){return"function"==typeof e},me=function(e){return"string"==typeof e},_e=function(e){return"boolean"==typeof e},we=function(e){return he(e)&&!fe(e)&&!isNaN(e)},be=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(null!=t&&pe(t)){var n=e.document;"loading"!==n.readyState?t():pe(n.addEventListener)?n.addEventListener("DOMContentLoaded",t):pe(e.attachEvent)&&e.attachEvent("onreadystatechange",function(e){"loading"!==n.readyState&&t(e)})}},ye=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return null};pe(t)&&(e.addEventListener("pagehide",function(e){return t(e),""}),e.addEventListener("beforeunload",function(e){return t(e),""}),e.addEventListener("onunload",function(e){return t(e),""}))},Se=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return null};pe(t)&&(e.removeEventListener("pagehide",t),e.removeEventListener("beforeunload",t),e.removeEventListener("onunload",t))},Ie=function(e,t,n){pe(e.removeEventListener)?e.removeEventListener(t,n):pe(e.detachEvent)?e.detachEvent(t,n):e["on"+t]=n},Oe=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=function(e){return e<10?"0"+e:e},i=e.getFullYear()+"-"+n(e.getMonth()+1)+"-"+n(e.getDate())+"T"+n(e.getHours())+":"+n(e.getMinutes())+":"+n(e.getSeconds());return t?i+e.toTimeString().split(" ")[1].replace(/GMT([+|-])(\d{2})(\d{2})/,"$1$2:$3"):i},Ce=function(){return Date.now()},xe=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e)},Ee=function(){var e=window.navigator,t=(void 0===e?{}:e).userAgent,n=void 0===t?"":t;switch(!0){case/Windows Phone/i.test(n)||/WPDesktop/.test(n):return"Windows Phone";case/iPad/.test(n):return"iPad";case/iPod/.test(n):return"iPod Touch";case/iPhone/.test(n):return"iPhone";case/(BlackBerry|PlayBook|BB10)/i.test(n):return"BlackBerry";case/Android/.test(n):return"Android";default:return"Desktop"}},ke=function(){var e,t,i,r,o,s,u,c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=c.navigator,d=void 0===l?{}:l,g=d.userAgent,f=void 0===g?"":g,h=d.vendor,M=void 0===h?"":h,D=v,J=p,P=m,j=_,L=w,W=b,q=y,R=S,B=I,F=O,U=C,G=x,z=E,K=k,H=T,X=N,Y=A,V=function(){switch(!0){case f.includes(" OPR/"):return f.includes("Mini")?D:J;case/(BlackBerry|PlayBook|BB10)/i.test(f):return P;case f.includes("IEMobile")||f.includes("WPDesktop"):return j;case f.includes("FBIOS"):return W;case f.includes("Chrome"):return q;case f.includes("CriOS"):return R;case f.includes("Edge"):return L;case f.includes("UCWEB")||f.includes("UCBrowser"):return B;case f.includes("FxiOS"):return F;case M.includes("Apple"):return f.includes("Mobile")?U:G;case f.includes("Android"):return z;case f.includes("Konqueror"):return K;case f.includes("Firefox"):return H;case f.includes("MSIE")||f.includes("Trident/"):return X;case f.includes("Gecko"):return Y;default:return""}}(),Z=function(){var e,t=(e={},a(e,j,/rv:(\d+(\.\d+)?)/),a(e,L,/Edge\/(\d+(\.\d+)?)/),a(e,q,/Chrome\/(\d+(\.\d+)?)/),a(e,R,/CriOS\/(\d+(\.\d+)?)/),a(e,B,/(UCBrowser|UCWEB)\/(\d+(\.\d+)?)/),a(e,G,/Version\/(\d+(\.\d+)?)/),a(e,U,/Version\/(\d+(\.\d+)?)/),a(e,J,/(Opera|OPR)\/(\d+(\.\d+)?)/),a(e,H,/Firefox\/(\d+(\.\d+)?)/),a(e,F,/FxiOS\/(\d+(\.\d+)?)/),a(e,K,/Konqueror:(\d+(\.\d+)?)/),a(e,P,/BlackBerry (\d+(\.\d+)?)/),a(e,z,/android\s(\d+(\.\d+)?)/),a(e,X,/(rv:|MSIE )(\d+(\.\d+)?)/),a(e,Y,/rv:(\d+(\.\d+)?)/),e)[V];if(void 0===t)return null;var n=f.match(t);return n?parseFloat(n[n.length-2]):null}(),Q=Ee(),$=function(){switch(!0){case/Windows/i.test(f):return/Phone/.test(f)||/WPDesktop/.test(f)?"Windows Phone":"Windows";case/(iPhone|iPad|iPod)/.test(f):return"iOS";case/Android/.test(f):return"Android";case/(BlackBerry|PlayBook|BB10)/i.test(f):return"BlackBerry";case/Mac/i.test(f):return"Mac OS X";case/Linux/.test(f):return"Linux";case/CrOS/.test(f):return"Chrome OS";default:return""}}();return n(n({},(e=c.screen,i=(t=void 0===e?{width:0,height:0}:e).height,r=t.width,o=c.devicePixelRatio,s=void 0===o?1:o,{dimensions:{width:r,height:i},dimensions_in_pixels:{width:(u=function(e){var t=Math.round(e)*s,n=t%10;return t+(n>0?10:0)-n})(r),height:u(i)},dpi:s.toString()})),{},{device:Q,browser_version:Z,browser:V,os:$})},Te=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.navigator,r=(void 0===i?{}:i).language,o=n.browser_version,s=n.browser,u=ae.isCookieAvailable();return a(e={},"apx_browser",s),a(e,"apx_browser_version",s+"_"+o),a(e,"apx_language",r),a(e,"apx_cookies_supported",u),e},Ne=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.navigator,n=void 0===t?{}:t,i=n.connection,r=void 0===i?{}:i,o=r.effectiveType,s=r.saveData,a=n.platform,u=n.webdriver,c=e.document.referrer,l={};o&&(l.apx_network=o),s&&(l.apx_data_save_mode=s),a&&(l.apx_platform=a),he(u)&&u&&(l.apx_automation=u),he(c)&&c.length>0?l.apx_referrer=c:l.apx_referrer="direct";var d=Ee();return l.apx_device_type=d,l},Ae=function(e){var t=e.document.querySelector("title");return he(t)&&he(t.innerText)?t.innerText:"Unknown"},Me=function(e){return we(e)?De(e/1e3):e},De=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(!we(e)||!we(t))return e;if(t%1!=0)return e;var n=Math.pow(10,t);return Math.round(e*n)/n},Je=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).location,t=void 0===e?{}:e,n=t.protocol,i=t.host,r=t.hostName;return"file:"===n||"localhost"===i||"0.0.0.0"===r||"127.0.0.1"===r?"development":"production"},Pe=function(e){return e instanceof Object},je=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(Pe(e)){var i={};return Object.keys(n({},e)).forEach(function(n){var r=e[n],o=n;me(n)||(o=JSON.stringify(n)),_e(r)||we(r)?qe(i,o,r):me(r)?i[o]=Re(r):Array.isArray(r)?Le(i,o,r,t):Pe(r)&&We(i,n,r,t-1)}),i}return{}},Le=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(i<=0)qe(e,t,JSON.stringify(n));else if(Array.isArray(n)){var r=n;if(r.length>0){var o="";_e(r[0])?o="b":me(r[0])?o="s":we(r[0])?o="n":Array.isArray(r[0])?o="a":Pe(r[0])&&(o="o");var s=r.length;if(""===o)return void qe(e,t,JSON.stringify(n));for(var a=1;a<s;a++)if("s"===o){if(!me(r[a]))return void qe(e,t,JSON.stringify(n))}else if("b"===o){if(!_e(r[a]))return void qe(e,t,JSON.stringify(n))}else if("n"===o){if(!we(r[a]))return void qe(e,t,JSON.stringify(n))}else if("a"===o){if(!Array.isArray(r[a]))return void qe(e,t,JSON.stringify(n))}else if("o"===o&&!Pe(r[a]))return void qe(e,t,JSON.stringify(n));if("o"===o)if(i-1<=0){for(var u=[],c=0;c<s;c++)u.push(JSON.stringify(r[c]));qe(e,t,u)}else for(var l=0;l<s;l++)We(e,t,r[l],i-1);else if("a"===o)for(var d=0;d<s;d++)qe(e,t,JSON.stringify(r[d]));else for(var g=0;g<s;g++)qe(e,t,r[g])}else qe(e,t,[])}},We=function e(t,i,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;o<=0?qe(t,i,JSON.stringify(r)):Object.keys(n({},r)).forEach(function(n){var s=i+"_"+n,a=r[n];he(a)&&(Array.isArray(a)?Le(t,s,a,o-1):Pe(a)?e(t,s,a,o-1):qe(t,s,a))})},qe=function(e,t,n){if(he(t)&&he(n))if(e[t]){var i=e[t],r=i;Array.isArray(i)||((we(i)&&!we(n)||_e(i)&&!_e(n)||me(i)&&!me(n)||Pe(i)&&!Pe(n))&&(me(i)||(i=JSON.stringify(i)),me(n)||(n=JSON.stringify(n))),(r=[]).push(i)),r.push(n),e[t]=r}else e[t]=n},Re=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:120;return me(e)?e.length>t?e.slice(0,t)+"...":e:void 0},Be=function(e){if(!he(e)&&!me(e))return null;if("object"===i(e)||Pe(e))return e;var t=e.replace(/(?:\r\n|\r|\n)/g,"").trim();try{return JSON.parse(t)}catch(e){}return null},Fe=function(e,t){return he(t)?function(e){var t,n,i,r,o,s,a,u,c,l=0,d="";if(!e)return e;do{t=e[l++],n=e[l++],i=e[l++],r=(u=t<<16|n<<8|i)>>18&63,o=u>>12&63,s=u>>6&63,a=63&u,d+=Ge.charAt(r)+Ge.charAt(o)+Ge.charAt(s)+Ge.charAt(a)}while(l<e.length);return((c=e.length%3)?d.slice(0,c-3):d)+"===".slice(c||3)}(t=function(e,t){return Array.from(t).map(function(t,n){return t.charCodeAt(0)^ze(e,n)})}(e,t)):null},Ue=function(e,t){return function(e,t){return Array.from(t).map(function(t,n){return String.fromCharCode(t^ze(e,n))}).join("")}(e,t=function(e){var t,n,i,r,o,s,a,u,c=0,l=[];if(!e)return e;e+="";do{r=Ge.indexOf(e.charAt(c++)),o=Ge.indexOf(e.charAt(c++)),s=Ge.indexOf(e.charAt(c++)),a=Ge.indexOf(e.charAt(c++)),t=(u=r<<18|o<<12|s<<6|a)>>16&255,n=u>>8&255,i=255&u,l.push(t),64!==s&&(l.push(n),64!==a&&l.push(i))}while(c<e.length);return l}(t))},Ge="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function ze(e,t){return e.charCodeAt(Math.floor(t%e.length))}String.prototype.includes||(String.prototype.includes=function(){return-1!==String.prototype.indexOf.apply(this,arguments)}),Array.from||(Array.from=(ue=Object.prototype.toString,ce=function(e){return"function"==typeof e||"[object Function]"===ue.call(e)},le=Math.pow(2,53)-1,de=function(e){var t=function(e){var t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(t>0?1:-1)*Math.floor(Math.abs(t)):t}(e);return Math.min(Math.max(t,0),le)},function(e){var t=Object(e);if(null==e)throw new TypeError("Array.from requires an array-like object - not null or undefined");var n,i=arguments.length>1?arguments[1]:void 0;if(void 0!==i){if(!ce(i))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(n=arguments[2])}for(var r,o=de(t.length),s=ce(this)?Object(new this(o)):new Array(o),a=0;a<o;)r=t[a],s[a]=i?void 0===n?i(r,a):i.call(n,r,a):r,a+=1;return s.length=o,s})),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(e,t){if(null==this)throw new TypeError('"this" is null or not defined');var n=Object(this),i=n.length>>>0;if(0===i)return!1;var r,o,s=0|t,a=Math.max(s>=0?s:i-Math.abs(s),0);for(;a<i;){if((r=n[a])===(o=e)||"number"==typeof r&&"number"==typeof o&&isNaN(r)&&isNaN(o))return!0;a++}return!1}});var Ke=["log","debug","info","warn","error"],He=Ke.reduce(function(e,t){return e[t]=t,e},{}),Xe=function(e){if(ge(e)){var t=function(){return null};e=Ke.reduce(function(e,n){return e[n]=t,e},{})}return e},Ye=function(){function e(){r(this,e)}return s(e,null,[{key:"enabled",set:function(t){e._enabled=t}},{key:"level",set:function(t){e._level=t}},{key:"console",set:function(t){e._console=Xe(t)}}]),e}();a(Ye,"_console",Xe()),a(Ye,"_enabled",!1),a(Ye,"_level","error"),a(Ye,"_render",function(e){return function(){var t=Ke.indexOf(e)>=Ke.indexOf(Ye._level);if(Ye._enabled&&t){for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];Ye._console[e].apply(Ye._console,i)}}}),a(Ye,"log",Ye._render(He.log)),a(Ye,"info",Ye._render(He.info)),a(Ye,"debug",Ye._render(He.debug)),a(Ye,"warn",Ye._render(He.warn)),a(Ye,"error",Ye._render(He.error));var Ve=s(function e(){var t=this;r(this,e),a(this,"enhp",function(e,n){if(t._listeners[e])for(var i=t._listeners[e],r=0;r<i.length;r++){(0,i[r])(n)}}),a(this,"registerForEvent",function(e,n){var i;pe(n)&&((i=t._listeners[e]?t._listeners[e]:[]).push(n),t._listeners[e]=i)}),a(this,"unregisterFromEvent",function(e,n){if(t._listeners[e]){for(var i=t._listeners[e],r=[],o=0;o<i.length;o++){var s=i[o];s!==n&&r.push(s)}t._listeners[e]=r}}),a(this,"oAOB",function(){t._listeners={}}),this._listeners={}}),Ze=function(e,t){return{name:e===G?"FOREGROUND":"BACKGROUND",time:we(t)?De(t):0}},Qe=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(me(e)&&Pe(t))return{name:e,additional_info:t,category:he(n)&&me(n)?n:void 0,time:we(i)?De(i):0}},$e=function(e,t,n,i,r){return{app_name:e,app_version:r=he(r)?r:"ALL",bundle_id:t,installation_time:n,app_mode:i}},et=function(e,t,n,i,r,o,s,a){return{id:e,hardware_model:t,dimensions:n,os_version:i,platform:"web",dpi:r,dimensions_in_pixels:o,browser:s,browser_version:a}},tt=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return{navigation_id:e,name:t,duration:we(n)?De(n):0,transition_time:we(i)?De(i):0}},nt={navigation_events:[],app_events:[],system_events:[],user_events:[],chunk_attributes:{},user_attributes:{},session_attributes:{}},it=function(e){return{sdk_version:190,config_id:"apx",tick_interval:1,chunk_retry_window:1800,sdk_start_time:e}},rt=function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return Ye.debug("Model : Building the initial state of the Chunk"),{sdk_info:it(e),session_info:{id:i,launch_time:t,launch_time_string:Oe(new Date(t)),startup_time:0,is_background:!1,is_first_session:!1,duration:0,total_duration:0,process_name:"",is_fatal:!1,launch_type:"normal"},app_info:{app_name:"",app_version:"ALL",bundle_id:"",installation_time:mt.getInstance().getInstallationTime(Ce()),app_mode:"production"},device_info:ke(window),chunk_meta:{id:i+":"+r,number:r,reporting_times:[]},chunk_details:n(n({},nt),{},{user_attributes:{},session_attributes:{}})}},ot=s(function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,e),a(this,"aWMx",function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=t.window.XMLHttpRequest;Ye.debug("Request : POST request with data"),s?t.akFp(e,n,i,r,o):(Ye.error("Request : Unknown browser"),i(403,"Unknown")),Ye.debug("Request : Sent request to server")}),a(this,"get",function(e,n){var i=t.window,r=i.fetch,o=i.XMLHttpRequest;if(r)r(e).then(function(e){try{if(e.ok)return e.json()}catch(e){Ye.debug("Request : Error while parsing the response ".concat(e))}return null}).then(function(e){he(e)?n(200,e):(Ye.error("Request : API request failed. ".concat(JSON.stringify(e))),n(500,{}))}).catch(function(e){Ye.error("Request : API request failed. ".concat(e)),n(500,e)});else if(o){var s=new o;s.open("GET",e,!0),s.onreadystatechange=function(){4===s.readyState&&n(s.status,s.responseText)},s.send()}else Ye.error("Request : Unknown browser"),n(403,"Unknown");Ye.debug("Request : sent request to server")}),a(this,"akFp",function(e,n,i,r,o){var s=new XMLHttpRequest;s.onerror=function(e){Ye.error("Request : API request failed. ".concat(e)),i(500,null)},s.open("POST",e,o),s.setRequestHeader("Content-Type","application/json; charset=UTF-8"),Object.keys(null!=r?r:{}).forEach(function(e){s.setRequestHeader(e,r[e])}),s.onreadystatechange=function(){if(4===s.readyState){var r=s.responseText,o=r.match(/Failed to execute 'send' on 'XMLHttpRequest'/);if(!(fe(o)||ge(o)||fe(o[0])||ge(o[0])||"Failed to execute 'send' on 'XMLHttpRequest'"!==o[0]))return void t.akFp(e,n,i,!0);try{r=JSON.parse(r)}catch(e){Ye.debug("Request : Error while parsing the response ".concat(e))}i(s.status,r)}};try{s.send(JSON.stringify(n))}catch(e){Ye.error("Request : API request failed. ".concat(e)),i(500,e)}}),this.window=n}),st=f.api_root,at=function(e,t){return st+e.replace("<app-id>",t)},ut=s(function e(t){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r(this,e),a(this,"KHei",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){return null},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return null};return function(n,i){Ye.debug("XHR Response: [".concat(n,"]")),n<400?i&&"APXOR_STATUS_SUCCESS"===i.apxor_status?i.details?e(i.details):e(i):200===n?e(i):t(n,i):t&&pe(t)&&t(n,i)}}),a(this,"qqJg",function(e,t){n.makeGetRequest(n.sdkEnabledStatusAPI,e,t)}),a(this,"HkLg",function(e,t){n.makeGetRequest(n.configAPI,e,t)}),a(this,"OmmB",function(e,t,i){n.request.aWMx(n.userInfoAPI,e,n.KHei(t,i),{})}),a(this,"vYWg",function(e,t,i){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];Ye.debug("Posting chunk"),n.request.aWMx(n.chunksAPI,e,n.KHei(t,i),{},r)}),a(this,"makeGetRequest",function(e,t,i){n.request.get(e,n.KHei(t,i))}),a(this,"makePostRequest",function(e,t,i,r,o){n.request.aWMx(e,t,n.KHei(r,o),i)}),this.request=new ot(i),this.configAPI=at("/config/<app-id>/web",t),this.chunksAPI=at("/<app-id>/chunks",t),this.sdkEnabledStatusAPI=at("/sdk/<app-id>/enabled-status?platform=web&version=190",t),this.userInfoAPI=at("/user?appId=<app-id>",t)}),ct=s(function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;r(this,e),a(this,"JWNX",-1),a(this,"ySYz",0),a(this,"rpWa",function(){return t.ySYz}),a(this,"QIGk",function(){return t.JWNX}),a(this,"fABu",function(){t.JWNX=-1,t.ySYz=0}),a(this,"KZUJ",function(e){if("FOREGROUND"===e.name){if(-1!==t.JWNX){var n=Math.round(Me(Date.now()-t.JWNX));t.ySYz+=n;var i=mt.getInstance().getFromStorage(ee);if(he(i)&&mt.getInstance().getSessionId()!==i){mt.getInstance().ycwT();var r=mt.getInstance().fCqc(),o=r.total_duration,s=r.duration;t.ySYz=o>s?o-s:0}}}else t.JWNX=Date.now(),mt.getInstance().persistToStorage(U,t.JWNX)}),mt.getInstance().registerForEvent(H,this._onSystemEvent),this.ySYz=n,mt.getInstance().persistToStorage(U,this.JWNX)}),lt=function(){function e(t){var n=this;r(this,e),a(this,"cguM",!1),a(this,"xAwv",function(e){var t=!0;try{window[e]?(window[e].setItem("_apx_","apx"),"apx"!==window[e].getItem("_apx_")&&(t=!1),window[e].removeItem("_apx_")):t=!1}catch(e){t=!1}return t||Ye.error("Storage : LocalStorage not supported"),t}),a(this,"qqoB",function(e){Ye.error("".concat(n.storageType," Error: "),e)}),a(this,"get",function(e){try{return n.storage.getItem(e)}catch(t){Ye.error("Storage : Error while getting the ".concat(e," from storage - ").concat(t))}return null}),a(this,"kZEV",function(e){try{return JSON.parse(n.storage.getItem(e))}catch(t){Ye.error("Storage : Error while parsing ".concat(e,"'s value from storage - ").concat(t))}return null}),a(this,"set",function(e,t){try{n.storage.setItem(e,t)}catch(t){Ye.error("Storage : Error while setting the ".concat(e,"'s value to storage - ").concat(t))}}),a(this,"orqV",function(e){try{n.storage.removeItem(e)}catch(t){Ye.error("Storage : Error while removing the ".concat(e," from storage - ").concat(t))}}),a(this,"clear",function(){try{n.storage.removeItem(D),n.storage.removeItem(J),n.storage.removeItem($),n.storage.removeItem(ee),n.storage.removeItem(P),n.storage.removeItem(M),n.storage.removeItem(B),n.storage.removeItem(F),n.storage.removeItem(U),n.storage.removeItem(te),n.storage.removeItem(ne),n.storage.removeItem(ie),n.storage.removeItem(re),n.storage.removeItem(oe),n.storage.removeItem(q),n.storage.removeItem(W),n.storage.removeItem(L),n.storage.removeItem(j)}catch(e){Ye.error("Storage : Error while clearing the storage - ".concat(e))}}),this.cguM=this.xAwv(t),this.cguM?(this.storage=window[t],this.storageType=t):(this.storageType=t,this.storage={length:0,getItem:function(){},setItem:function(){},removeItem:function(){},clear:function(){},get:function(){},set:function(){},remove:function(){},getParsed:function(){}})}return s(e,[{key:"isStorageAvailable",value:function(){return this.cguM}}],[{key:"waitForBrowserStorage",value:function(t){var n=15,i=setInterval(function(){n--,e.isLocalStorageEnabled()||n<=0?(Ye.debug("Storage : Local storage available"),clearInterval(i),t()):Ye.debug("Storage : Local storage not available yet")},100)}},{key:"isLocalStorageEnabled",value:function(){try{var e="__apx_storage_test__";window.localStorage.setItem(e,"test");var t=window.localStorage.getItem(e);return window.localStorage.removeItem(e),"test"===t}catch(e){return Ye.debug("Browser storage is not enabled yet : ".concat(e)),!1}}}]),e}();var dt=function(){function e(t){var i=this;r(this,e),a(this,"BRCw",""),a(this,"fMbK",function(){var e,t=i.storage.get(D);if(he(t))try{t=JSON.parse(Ue(i.BRCw,t))}catch(e){t=null}return null!==(e=t)&&void 0!==e?e:f}),a(this,"CcIH",function(e){i.storage.set(D,Fe(i.BRCw,JSON.stringify(e)))}),a(this,"POpT",function(e){i.storage.set(M,e)}),a(this,"nLic",function(){var e=null;try{e=i.storage.get(M)}catch(e){Ye.debug("Datamaager : Can not get user id from storage-"+e)}return e}),a(this,"dEbY",function(e){return i.storage.set(F,e)}),a(this,"djnw",function(){var e=i.storage.get(F);if(!he(e)&&ae.isCookieAvailable()){var t=ae.get(F);if(he(t))return i.storage.set(F,t),t}return e}),a(this,"ixJM",function(e,t){i.storage.set(e,t)}),a(this,"getItem",function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=i.storage.get(e);if(t){var r=Be(n);if(null===r)try{n=JSON.parse(Ue(i.BRCw,n))}catch(t){Ye.debug("Datamanager : ".concat(e," - value not found in storage")),n=null}else n=r}return Ye.debug("Datamanager : ".concat(e,"'s value from storage is ").concat(JSON.stringify(n))),n}),a(this,"EFug",function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=i.getItem(e,n);return he(r)?r:(Ye.debug("Datamanager : ".concat(e,"'s value is not defined. Returning default-").concat(JSON.stringify(t))),t)}),a(this,"QgLM",function(){i.storage.clear()}),a(this,"DfZd",function(e){Ye.debug("DataManager : Setting the installation time to ".concat(e)),i.storage.set(B,e)}),a(this,"getInstallationTime",function(e){var t=i.storage.get(B);return he(t)?(Ye.debug("Datamanager : Stored installation time ".concat(t)),Number(t)):(Ye.debug("Datamanager : Stored installation time not found. Persisting and returning the default time ".concat(e)),i.DfZd(e),e)}),a(this,"hTBv",function(e){Ye.debug("Datamanager : Persisting the old session chunk to the storage"),i.storage.set(ne,Fe(i.BRCw,JSON.stringify(e)))}),a(this,"Pfzi",function(){var e;Ye.debug("Datamanager : Getting the old session chunk details form the storage");var t=i.storage.get(ne),n=Be(t);if(null===n)try{t=JSON.parse(Ue(i.BRCw,t))}catch(e){t=null}else t=n;return null!==(e=t)&&void 0!==e?e:[]}),a(this,"idJv",function(){Ye.debug("Datamanager : Removing the old session chunk details form the storage"),i.storage.orqV(ne)}),a(this,"IzDL",function(){return i.getItem(re,!0)}),a(this,"OzRy",function(e){Ye.debug("Datamanager : Persisting the old session chunk details to the storage"),i.storage.set(re,Fe(i.BRCw,JSON.stringify(e)))}),a(this,"qJWe",function(){Ye.debug("Datamanager : Removing the old session chunk details form the storage"),i.storage.orqV(re)}),a(this,"UAgP",function(){Ye.debug("Datamanager : Getting the session chunknumber map");var e=i.getItem(oe,!0);return he(e)||(e={}),e}),a(this,"bHUt",function(e){Ye.debug("Datamanager : Persisting the new session chunknumber map");var t=Fe(i.BRCw,JSON.stringify(e));i.ixJM(oe,t)}),a(this,"gQqL",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now(),r=arguments.length>2?arguments[2]:void 0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3600;Ye.debug("Datamanager : Creating a new chunk");var s,a=!1,u=Number(i.storage.get($))||0,c=Date.now(),l=Math.round(Me(c-u)),d=i.uQIQ();if((l>o||ve(d))&&(a=!0),a)Ye.debug("Datamanager : This is a new session. Creating a new chunk"),s=rt(e,t,r);else{Ye.debug("Datamanager : This is an old session. Updating the existing chunk");var g=d.chunk_meta.number,f=d.session_info.id,h=g+1;(s=n({},d)).chunk_meta=n(n({},s.chunk_meta),{},{number:h,id:f+":"+h,reporting_times:[Date.now()]}),s.chunk_details=n({},nt)}return{is_new_session:a,chunk:s}}),a(this,"oInv",function(){Ye.debug("Datamanager : Current chunk removed from storage"),i.storage.orqV(te)}),a(this,"sjIE",function(e){Ye.debug("Datamanager : Persisting the Current chunk to storage"),i.storage.set(te,Fe(i.BRCw,JSON.stringify(e)))}),a(this,"uQIQ",function(){return i.getItem(te,!0)}),this.BRCw=t,this.storage=new lt("localStorage"),Ye.debug("DataManager : Initialized")}return s(e,[{key:"getltCount",value:function(e){try{var t=this.storage.get(ie);if(t){var n=Ue(this.BRCw,t);return JSON.parse(n)[e.replace("'","").replace("â€™","")]}}catch(t){Ye.error("Datamanager : Error gettting the LT Count for the event -"+e)}return 0}},{key:"updateRetainedDayCount",value:function(e){Ye.debug("Datamanager : Re-calculating and updating the retention day");var t=this.getItem(B),n=Math.abs(t-e)/36e5,i=Math.floor(n/24);this.ixJM("apx_retained_days",i)}}]),e}(),gt=["scroll","touchmove"],ft=s(function e(){var t=this,n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];r(this,e),a(this,"xMcF",!0),a(this,"LEMZ",function(){Ye.debug("Registering for System Event ","visibilitychange");var e=function(){var e=mt.getInstance(),n=e.getSDKRunningTimeInSec(),i=window.document.visibilityState===G,r=Ze(window.document.visibilityState,n);if(i?(e.qcER(!1),t.JWNX>-1&&(e.JpIY(function(){e.dispatchEvent(H,r)}),r.background_time=De(Me(Date.now()-t.JWNX)))):(e.qcER(!0),e.kMkU(),t.JWNX=Date.now(),e.dispatchEvent(H,r)),i){var o=e.getUserAttributes().apx_browser;!t.xMcF||-1!==o.indexOf("Mobile Safari")&&-1!==o.indexOf("Safari")||(t.xMcF=!1)}else e.fayb()};!function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];pe(e.addEventListener)?e.addEventListener(t,n,i):pe(e.attachEvent)?e.attachEvent(t,n):e["on"+t]=n}(document,"visibilitychange",e),t._handlers.push(t.QWrI("visibilitychange",e))}),a(this,"OwkT",function(){t._handlers.forEach(function(e){var t=e.type,n=e.handler;Ye.debug("Unregistering from event type ",t),gt.includes(t)?Ie(window.document,t,n):Ie(document,t,n)}),t._handlers=[],t._scrollEvents=[],t._scrollData={}}),a(this,"LwAX",function(){return[]}),a(this,"QWrI",function(e,t){return{type:e,handler:t}}),this.JWNX=-1,this._handlers=[],this._scrollEvents=[],this._scrollData={},this.xMcF=n,this.LEMZ()}),ht=s(function e(){var t=this;r(this,e),a(this,"zSRB",!0),a(this,"BRCw",""),a(this,"initialize",function(e,n){t.BRCw=n;var i=e.validate_hash,r=void 0===i||i,o=e.cs_ht_time,s=void 0===o?-1:o;t.zSRB=r,t.configsHashThrottleTime=s,mt.getInstance().registerForEvent(Y,function(e){t.ysKZ(e.name)})}),a(this,"fetchConfiguration",function(e,n,i,r){if(pe(r))if(t.zSRB){var o=mt.getInstance();if(t.configsHashThrottleTime>0){var s=o.jZCm(e+"_lcfht",-1);if(s>0)if(Math.abs(Date.now()-s)<t.configsHashThrottleTime)return void t.ggFq(e,r)}o.persistToStorage(e+"_lcfht",Date.now());var a=t.Zzqv(),u={pid_mid:[]},c=a[e];if(he(c)){Array.isArray(c)||(c=[c]);var l=[];c.forEach(function(e){var t=e.pid+"_"+e.mid;l.includes(t)||l.push(t)}),l.length>0&&(u.pid_mid=l.join(","))}else c=[];var d=o.getUserAttributes().custom_user_id,g=void 0===d?null:d;g&&(n+="&customerId="+g),o.makePostRequest(n,u,{"Content-Type":"application/json"},function(n){t.nGvM(n,e,i,{configs:c,syncData:a},r)},function(){Ye.error("Failed to fetch"),r(e,{configs:c})})}else t.fgNy(e,i,[],r)}),a(this,"Zzqv",function(){var e=mt.getInstance().getFromStorage(P,!0);return he(e)?e:{}}),a(this,"ggFq",function(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=i;i||(r=t.Zzqv());var o=r[e];he(o)&&(Array.isArray(o)||(o=[o]),Ye.debug("Reading from storage"),n(e,{configs:o}))}),a(this,"nGvM",function(e,n,i,r,o){var s=e.pull,a=void 0===s?[]:s,u=e.drop,c=void 0===u?[]:u,l=r.configs,d=r.syncData,g=[];c.length>0||a.length>0?(l.forEach(function(e){c.includes(e.pid)||a.includes(e.pid)||g.push(e)}),d[n]=g,mt.getInstance().persistToStorage(P,Fe(t.BRCw,JSON.stringify(d)))):(Ye.debug("Nothing to delete",n),g=l),a.length>0?(a.forEach(function(e){i+="&pids="+e}),t.fgNy(n,i,g,o)):(Ye.debug("Nothing to pull",n),o(n,{configs:g}))}),a(this,"fgNy",function(e,n,i,r){mt.getInstance().makeGetRequest(n,function(n){if(he(n.configs)&&Array.isArray(n.configs)&&0==n.configs.length)r("",{configs:[]});else if(he(n.configs)&&Array.isArray(n.configs)){var o=t.Zzqv(),s=[].concat(c(i),c(n.configs));o[e]=s,mt.getInstance().persistToStorage(P,Fe(t.BRCw,JSON.stringify(o))),r(e,{configs:s})}},function(){r(e,{configs:[]})})}),a(this,"MRcz",function(e){t.ysKZ(e)}),a(this,"ysKZ",function(e){var n=t.Zzqv();if(he(n.d)||(n.d={}),JSON.stringify(n.d).length>2097152)Ye.error("Sync : Reached maximum limit. Can't store further");else{var i=0;he(n.d[e])&&(i=n.d[e]),i+=1,n.d[e]=i,mt.getInstance().persistToStorage(P,Fe(t.BRCw,JSON.stringify(n)))}}),a(this,"getEventCount",function(e){var n=t.Zzqv();return he(n.d)&&he(n.d[e])?n.d[e]:0})}),vt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return function(){Ye.error("".concat(e,": Apxor SDK not initialised."))}},pt={reportChunkOnVisibilityChange:vt("kMkU"),logAppEvent:vt("xfBF"),logClientEvent:vt("logClientEvent"),logPageView:vt("logPageView"),setUserId:vt("setUserId"),setUserProperties:vt("setUserProperties"),setSessionProperties:vt("setSessionProperties"),setAppVersion:vt("setAppVersion"),getClientId:vt("getClientId"),getSessionId:vt("getSessionId"),startSession:vt("startSession"),endSession:vt("endSession"),flattenJSON:vt("flattenJSON"),setRedirectionHandler:vt("setRedirectionHandler"),setInitFlag:vt("setInitFlag")},mt=function(){function t(){var i=this;return r(this,t),a(this,"OfEC",{}),a(this,"jOyM",!1),a(this,"LtoP",{}),a(this,"zSbH",{}),a(this,"sLPt",{}),a(this,"Imqv",{}),a(this,"mnUp",{}),a(this,"YITg",{}),a(this,"NnaL",{}),a(this,"WxNL",1),a(this,"xgHj",null),a(this,"LOdw",!1),a(this,"MJGq",!1),a(this,"uWcJ",{}),a(this,"MEiE",{}),a(this,"ZPph",{}),a(this,"fYaM",{}),a(this,"xZkT",3600),a(this,"yVqf",20),a(this,"DieO",-1),a(this,"nyFc",2e4),a(this,"cDRG",-1),a(this,"sqAc",10),a(this,"HOhq",!1),a(this,"FSHi",!1),a(this,"KSDx",-1),a(this,"rqjr",!1),a(this,"SzsO",!0),a(this,"clientEvents",[]),a(this,"WYdp",[]),a(this,"oNAi",[]),a(this,"itzX",[]),a(this,"sqKL",{}),a(this,"MtWo",-1),a(this,"IGdA",null),a(this,"IsoN",null),a(this,"aBGB",null),a(this,"DPXt",!1),a(this,"RrXQ",!1),a(this,"Fjeh",{}),a(this,"initWaitTime",1500),a(this,"version",""),a(this,"sItP",""),a(this,"BHou",""),a(this,"sessionStartTime",null),a(this,"sessionId",""),a(this,"TExs",{}),a(this,"xOAm",function(e){var t=i.config.plugins;if(he(t)&&he(t.length))for(var n=0;n<t.length;n++){var r=t[n];try{var o;null===(o=window[r])||void 0===o||o.init(e),Ye.debug("Controller : Initialized plugin ".concat(r))}catch(e){Ye.error("Controller : Failed to initialize plugin ".concat(r," with error ").concat(e))}}}),a(this,"initialize",function(e,t,n,r,o,s){if(!i.jOyM){var a=function(){Ye.debug("Controller : On Site enabled in config"),i.MtdT(u,s)},u=function(e){i.BHou=e,Ye.debug("Controller : On config hash fetch"),i.ktlc(e,c)},c=function(){Ye.info("Controller : Waiting for resources completed"),i.QEtn(),i.wKTW(),i.yvep(),i.sItP=i.FFEF(),i.PRVv(),i.AruV(),i.SXVC(),i.byLu(),i.mSIB(),i.UBWg(),i.Sjkc(),i.naUa(i.BHou);var e=i.IBBA();i.ZPph=new ct(e),i.GrOC(),i.JpIY(l)},l=function(){i.LOdw=!0,i.jOyM=!0;var e=i.ycwT();i.uWcJ.sjIE(e),i.xOAm(d)},d=function(){i.fasj(i.window.document.visibilityState),i.newSession&&(i.sessionStartTime=Date.now(),i.xfBF(K,{time:Oe(new Date)}),i.nPoa()),i.logPageView(i.window.location.pathname),i.QtdC(),i.nkje(),o()};i.rIxW(function(){Ye.debug("Controller : Wait for browser storage completed."),i.pbjK(e,t,n,r),i.Zise(),i.UAan(),i.fYaM.initialize(i.config,i.siteId),i.Xdrw(a,s)})}}),a(this,"getSiteId",function(){return i.siteId}),a(this,"setRedirectionHandler",function(e){i.jOyM?i.IGdA?i.IGdA=e:(i.IGdA=e,i.registerForEvent("CLIENT_EVENT",i.FAxQ)):pt.setRedirectionHandler()}),a(this,"FAxQ",function(e){e&&"REDIRECT"===e.name&&i.IGdA(e.additional_info.url)}),a(this,"makePostRequest",function(e,t,n,r,o){i._api.makePostRequest(e,t,n,r,o)}),a(this,"getDevInfo",function(){return i.zSbH}),a(this,"wpuL",function(){return i.Fjeh}),a(this,"MBsb",function(e,t){i.Fjeh[e]=i.Fjeh[e]||{},i.Fjeh[e]=n(n({},i.Fjeh[e]),t)}),a(this,"getInstallationTime",function(){return i.uWcJ.getInstallationTime(i.startTime)}),a(this,"rIxW",function(e){Ye.debug("Controller : Checking if the browsers localstorage is available."),lt.waitForBrowserStorage(e)}),a(this,"pbjK",function(e,t,n,r){Ye.debug("Controller : Initializing the state variables"),i.window=r,i.startTime=t,i.siteId=e,i.clientConfig=n||{},i.initWaitTime=i.clientConfig.sdk_init_wait?1e3*i.clientConfig.sdk_init_wait:2e3,i._api=new ut(i.siteId,i.window),i.uWcJ=new dt(i.siteId),i.OfEC=new Ve,i.fYaM=new ht,i.sLPt=it(i.startTime),i.sessionStartTime=i.uWcJ.EFug(se,t),Ye.debug("Controller : session start time is ".concat(i.sessionStartTime)),Ye.debug("Controller : SDK start time is ".concat(i.startTime)),i.sessionId=i.getFromStorage(ee)}),a(this,"wKTW",function(){Ye.debug("Controller : Initializing the LT Count ");try{var e=i.getFromStorage(ie);if(e)i.TExs=JSON.parse(Ue(i.siteId,e));else{i.TExs={};var t=Fe(i.siteId,JSON.stringify(i.TExs));i.persistToStorage(ie,t)}}catch(e){Ye.error("Controller : LT Count object parsing failed ".concat(e))}}),a(this,"QEtn",function(){var e=new URLSearchParams(location.search),t=e.get("_a")||e.get("_p")||e.get("_x")||e.get("_o")||e.get("_r");if(t)try{Ye.debug("Controller : Initialising in WYSIWYG mode");var n=Ue(i.siteId,t),r=n=JSON.parse(n),o=r.app_id,s=r.expiry,a=Date.now();if(o===i.siteId&&a<=s){var u=new Date(s+6e4).toUTCString(),c=btoa("_apx_ew");document.cookie="_apx_ewc=".concat(c,"; expires=").concat(u),n.expiry=n.expiry+6e4,i.persistToStorage("_apx_ew",n,!0),Ye.debug("Controller : _apx_ewc cookie set")}e.delete("_a"),e.delete("_p"),e.delete("_x"),e.delete("_o"),e.delete("_r");var l=location.pathname,d=e.toString();""!==d&&(l+="?"+d),i.window.history.replaceState({},document.title,l),Ye.debug("Controller : Query params reset after removing dashboard embedded params")}catch(e){Ye.error("Controller : Error while setting the WYSIWYG cookie ".concat(e))}else Ye.debug("Controller : Not in WYSIWYG mode")}),a(this,"Zise",function(){Ye.debug("Controller : Setting the config");var e=i.uWcJ.fMbK();i.Blxj(e)}),a(this,"Blxj",function(e){i.config=n(n({},e),i.clientConfig),Ye.debug("Controller : New config and client configs Configs merged")}),a(this,"UAan",function(){var e,t,n,r=i.config,o=r.version,s=void 0===o?"":o,a=r.bulk_upload,u=void 0===a||a,c=r.events_upload_time,l=r.idle_time_out,d=void 0===l?1800:l,g=r.events,f=void 0===g?{}:g,h=r.max_chunk_event_count,v=void 0===h?20:h,p=r.retry_time,m=r.max_sessions_in_storage,_=void 0===m?-1:m;i.version=i.eNGr(s),i.SzsO=u,i.rqjr=c>0,i.xZkT=we(d)?d:1800,i.WYdp=null!==(e=f.stop)&&void 0!==e?e:[],i.oNAi=null!==(t=f.action)&&void 0!==t?t:[],i.itzX=null!==(n=f.app)&&void 0!==n?n:[],i.yVqf=he(v)&&we(v)?v:20,i.DieO=he(c)&&we(c)&&c>=1e3?c:-1,i.cDRG=he(p)&&we(p)&&p>=1e3?p:-1,i.sqAc=we(_)&&_>0?_:-1}),a(this,"eNGr",function(e){var t;if(he(e))t=""+e,i.uWcJ.dEbY(t);else{var n=i.uWcJ.djnw();t=he(n)?n:"ALL"}return t}),a(this,"Xdrw",function(e,t){if(Ye.debug("Controller : Checking if the Site is enabled existing config"),!i.config.enable)return Ye.debug("Controller : Site is disabled. Can't initialise"),i.naUa(""),i.SXVC(),void t();e()}),a(this,"MtdT",function(e,t){var n=i.uWcJ.fMbK(),r=i.uWcJ.EFug(j,-1),o=n.ed_t_time;if(o>0&&r>0&&Math.abs(r-Date.now())<60*o*1e3)return Ye.debug("Controller : Reinitializing with in the throttling time."),i.uWcJ.EFug(L,!0)?void e(i.uWcJ.EFug(W,"")):(Ye.debug("Controller : Site is not enabled from the last update. Can't initalise now. Recheck will happen after throttling time"),void t());i.wYnr(e,t)}),a(this,"wYnr",function(e,t){Ye.debug("Controller : Getting the site enabled status from the server"),i.persistToStorage(j,Date.now()),i._api.qqJg(function(n){var r=n.enabled,o=n.hash;i.persistToStorage(L,r),r?(Ye.debug("Controller : Site is enabled"),e(o)):(Ye.debug("Controller : Site is disabled. Can't initialise the SDK"),i.jOyM=!1,i.LOdw=!1,i.GrLF(),t())},function(e){Ye.error("Controller : enabled-status API failed ".concat(e))})}),a(this,"GrLF",function(){Ye.debug("Controller: Stopping the SDK");try{var e,t;i.LOdw=!1,i.jOyM=!1,i.HOhq=!1,null===(e=i.OfEC)||void 0===e||e.oAOB(),null===(t=i.MEiE)||void 0===t||t.OwkT()}catch(e){Ye.error("Controller : Failed to stop the SDK ".concat(e))}}),a(this,"ktlc",function(e,t){Ye.debug("Controller: Waiting ".concat(i.initWaitTime,"ms for all the resource loading to finish")),setTimeout(function(){t(e)},i.initWaitTime)}),a(this,"FFEF",function(){var e=i.uWcJ.nLic();if(!he(e)){Ye.debug("Controller : Device id not found in localstorage");var t=i.config.client_id;he(t)&&""!==t?(Ye.debug("Controller : client id from clientconfig is the deviceid"),e=t):(Ye.debug("Controller : Generated a new device id. This is a new device now"),e=xe()),i.pIlf(e)}return Ye.debug("Controller : Device id is ".concat(e)),i.sItP=e,e}),a(this,"pIlf",function(e){i.uWcJ.QgLM(),i.uWcJ.POpT(e),i.uWcJ.DfZd(Date.now()),i.Imqv=n(n({},i.Imqv),{},{is_first_session:!0}),i.FSHi=!0}),a(this,"UBWg",function(){Ye.debug("Controller : Setting the session state for session if ".concat(i.sessionId)),i.sessionId||(i.newSession=!0,i.sessionId=xe(),i.persistToStorage(ee,i.sessionId),i.persistToStorage(se,i.sessionStartTime))}),a(this,"PRVv",function(){var e=ke(i.window),t=e.device,n=e.os,r=e.browser_version,o=e.browser,s=e.dimensions,a=e.dpi,u=e.dimensions_in_pixels;i.zSbH=et(i.sItP,t,s,n,a,u,o,r)}),a(this,"AruV",function(){Ye.debug("Controller : Setting the default User attributes");var e=n({},i.zSbH),t=Te(i.window,e);i.mnUp=n(n({},i.mnUp),t)}),a(this,"mSIB",function(){Ye.debug("Controller : Setting the default session attributes");var e=Ne(i.window);i.YITg=n(n({},i.YITg),e)}),a(this,"byLu",function(){Ye.debug("Controller : Merging the stored and default user attributes");var e=i.getFromStorage(J,!0);if(he(e)){var t,r=Be(e);if(null===r)try{r=JSON.parse(Ue(i.siteId,e))}catch(e){r={}}i.mnUp=n(n({},i.mnUp),null!==(t=r)&&void 0!==t?t:{})}}),a(this,"Sjkc",function(){i.NnaL=n(n({},nt),{},{user_attributes:n({},i.mnUp),session_attributes:n({},i.YITg)}),i.uWcJ.OzRy(i.NnaL)}),a(this,"JpIY",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};Ye.debug("Controller : Sending the old chunk to the server");var t=i.uWcJ.Pfzi();if(he(t)){var r,o,s,a,u,c,l=n({},i.NnaL);if(i.NnaL=n({},t.chunk_details)||{},(null===(r=i.NnaL)||void 0===r||null===(r=r.app_events)||void 0===r?void 0:r.length)>0||i.RucO(),!((null===(o=i.NnaL)||void 0===o||null===(o=o.app_events)||void 0===o?void 0:o.length)>0))return i.NnaL=n({},l),void e();var d=null!==(s=null===(a=t=n(n({},t),{},{chunk_details:n({},i.NnaL)}))||void 0===a||null===(a=a.session_info)||void 0===a?void 0:a.id)&&void 0!==s?s:"1",g=null!==(u=null===(c=t)||void 0===c||null===(c=c.chunk_meta)||void 0===c?void 0:c.number)&&void 0!==u?u:1;i.uWcJ.sjIE(t),i._api.vYWg(t,function(){i.ElQJ(d,g+1),Ye.debug("Controller : Old chunk reporting successful."),i.uWcJ.idJv(),i.uWcJ.qJWe(),i.Sjkc(),i.bgml(),e()},function(){Ye.debug("Controller : Old chunk reporting failed."),e()})}else e()}),a(this,"RucO",function(){var e=i.uWcJ.IzDL();if(he(e)){var t=e.app_events,n=e.navigation_events,r=e.system_events,o=e.user_events;i.NnaL.app_events=[].concat(c(i.NnaL.app_events||[]),c(t)),i.NnaL.navigation_events=[].concat(c(i.NnaL.navigation_events||[]),c(n)),i.NnaL.system_events=[].concat(c(i.NnaL.system_events||[]),c(r)),i.NnaL.user_events=[].concat(c(i.NnaL.user_events||[]),c(o)),i.uWcJ.qJWe()}}),a(this,"ElQJ",function(e,t){var n=i.uWcJ.UAgP();n[e]=t,i.uWcJ.bHUt(n),i.WxNL=t}),a(this,"bgml",function(){var e=i.ycwT();return i.uWcJ.sjIE(e),e}),a(this,"ycwT",function(){var e=he(i.config.name)?i.config.name:"",t=he(i.config.domain)?i.config.domain:"",r=i.uWcJ.gQqL(i.startTime,i.sessionStartTime,i.sessionId,i.xZkT),o=r.chunk,s=o.session_info,a=o.app_info,u=o.sdk_info,c=o.chunk_details,l=o.chunk_meta,d=c.session_attributes,g=c.user_attributes;return i.Imqv=s,i.Imqv.is_first_session=i.FSHi,i.sLPt=u,i.LtoP=n(n({},a),{},{app_name:e,bundle_id:t,app_version:i.version}),i.WxNL=l.number,i.mnUp=n(n({},i.mnUp),g),i.YITg=n(n({},i.YITg),d),i.NnaL=c,i.RucO(),i.newSession=r.is_new_session,i.newSession||i.jEmO(o),{sdk_info:i.sLPt,session_info:i.Imqv,app_info:i.LtoP,device_info:i.zSbH,chunk_details:c,chunk_meta:l}}),a(this,"jEmO",function(e){var t=e.session_info.id;t&&(i.sessionId=t,i.persistToStorage(ee,i.sessionId))}),a(this,"IBBA",function(){var e=i.Imqv,t=e.total_duration,n=e.duration;return t>n?t-n:0}),a(this,"naUa",function(t){if(Ye.debug("Controller : Fetch a new config"),i.tlnh(t)){var n=i.config.sct_time,r=i.uWcJ.EFug(q,-1);if(n>0&&r>0)if(Math.abs(Date.now()-r)<n)return void Ye.debug("Controller : No need to fetch config. Did not pass the throttle time");i.persistToStorage(q,Date.now()),i._api.HkLg(function(t){var n;Ye.debug("Controller : New config fetched"),i.uWcJ.CcIH(t),i.persistToStorage(W,null!==(n=t.hash)&&void 0!==n?n:e(t)),i.Blxj(t),i.yvep()},function(e){0!==e&&Ye.error("Controller : Failed to fetch config")})}else Ye.debug("Controller : No need to fetch config. No change in hash")}),a(this,"SXVC",function(){Ye.debug("Controller : Posting user info");var t=i.sLPt.sdk_version,n={sdk_version:JSON.stringify(t),app_info:i.LtoP,device_info:i.zSbH,user_attributes:i.mnUp},r=e(n),o=i.uWcJ.EFug(R,"");r!==o?i._api.OmmB(n,function(){Ye.debug("Controller : Posted user info. Persisting the hash to localstorage"),i.persistToStorage(R,r)}):Ye.debug("Controller : No need to post user info. No change in it")}),a(this,"tlnh",function(e){return""===e||i.uWcJ.EFug(W,"")!==e}),a(this,"fasj",function(e){Ye.debug("Controller : Dispatching SYSTEM_EVENT");var t=Ze(e,i.knMB());i.dispatchEvent(H,t)}),a(this,"nPoa",function(){Ye.debug("Controller : Resetting the session frequncy of all the campaigns to 0");var e={};try{var t=i.getFromStorage(Q);he(t)&&(e=JSON.parse(Ue(i.siteId,t))),Object.entries(e).forEach(function(t){var n=u(t,1)[0];return e[n].SESSION=0})}catch(t){e={},Ye.error("Controller : Can't reset campaign limits:".concat(t))}i.persistToStorage(Q,e,!0),i.window.ApxorRTM.resetFrequencyCounts()}),a(this,"GrOC",function(){Ye.debug("Registering a handler for the system events"),be(i.window,function(){i.MJGq||(i.ImnP(),i.MEiE=new ft(!1),i.MJGq=!0)})}),a(this,"ImnP",function(){var e=!1;ye(window,function(){(Ye.debug("Controller : Executing before unload"),e)||i.LOdw&&(e=!0,window.document.visibilityState===G&&(i.RtXj(!0),i.fasj("hidden")),clearInterval(i.IsoN),clearInterval(i.aBGB),i.SzsO&&i.uWcJ.OzRy(i.NnaL),i.MEiE.OwkT())})}),a(this,"nkje",function(){Ye.debug("Controller : Registering the handlers for chunk reporting"),clearInterval(i.aBGB),i.aBGB=setInterval(function(){i.QtdC()},i.nyFc),i.rqjr&&(clearInterval(i.IsoN),i.IsoN=setInterval(function(){i.MQqt()},i.DieO))}),a(this,"QtdC",function(){var e=i.NnaL,t=e.app_events,n=e.navigation_events;t.length+n.length>0&&!i.DPXt&&i.npCg()}),a(this,"MQqt",function(){var e=i.NnaL,t=e.app_events,n=e.navigation_events,r=t.length+n.length;(!i.SzsO&&r>0||i.SzsO&&r>=i.yVqf)&&i.npCg()}),a(this,"npCg",function(){Ye.debug("Controller : Preparing and reporting chunk");var e=i.mwcz(i.NnaL);i.gOmp(e,!1)}),a(this,"mwcz",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Ye.debug("Controller : Preparing chunk"),i.OpYy();var t={id:i.sessionId+":"+i.WxNL,number:i.WxNL,reporting_times:[Date.now()]};return e=n(n({},e),{},{user_attributes:i.mnUp,session_attributes:i.YITg}),{sdk_info:i.sLPt,session_info:i.Imqv,app_info:i.LtoP,device_info:i.zSbH,chunk_meta:t,chunk_details:e}}),a(this,"OpYy",function(){Ye.debug("Controller : Updating the foreground time");var e=i.getSDKRunningTimeInSec(),t=e;e-=i.ZPph.rpWa(),i.Imqv=n(n({},i.Imqv),{},{duration:De(e),total_duration:De(t)})}),a(this,"gOmp",function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};if(Ye.debug("Controller : Reporting chunk"),i.HOhq||i.cDRG>0&&-1!==i.KSDx&&Date.now()-i.KSDx<i.cDRG)i.Sjkc();else{var r=e.chunk_details,o=r.app_events,s=r.system_events,a=r.navigation_events,u=r.user_events;if(o.length<1&&s.length<1&&a.length<1&&u.length<1)return Ye.debug("Controller : Chunk not sent. No events in the chunk"),i.HOhq=!1,void n();i.HOhq=!0,i.ElQJ(i.Imqv.id,i.WxNL+1),i.uWcJ.qJWe(),i.uWcJ.idJv(),i.Sjkc(),t?(i.HOhq=!1,i.uWcJ.hTBv(e),n()):(i.uWcJ.sjIE(e),i._api.vYWg(e,function(){Ye.debug("Controller : Chunk successfully sent"),i.HOhq=!1,i.KSDx=-1,n()},function(t){Ye.debug("Controller : Chunk sending failed"),0!==t&&(i.HOhq=!1,t>=500&&(i.KSDx=Date.now()),413!==t&&417!==t&&i.uWcJ.hTBv(e),n())}))}}),a(this,"setUserId",function(e){i.jOyM?i.LOdw?ge(e)||(Ye.debug("Controller : User id set"),i.setUserProperties({custom_user_id:e})):Ye.warn("Apxor SDK is not running"):pt.setUserId()}),a(this,"setUserProperties",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(i.jOyM)if(i.LOdw){if(Object.keys(e).length>0){i.mnUp=n(n({},i.mnUp),e);try{Ye.debug("Controller : User properties set"),i.persistToStorage(J,Fe(i.siteId,JSON.stringify(i.mnUp)))}catch(e){Ye.debug("Controller : Error while setting the use properties ".concat(e))}}}else Ye.warn("Apxor SDK is not running");else pt.setUserProperties()}),a(this,"setSessionProperties",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i.jOyM?i.LOdw?Object.keys(e).length>0&&(Ye.debug("Controller : Session properties set"),i.YITg=n(n({},i.YITg),e)):Ye.warn("Apxor SDK is not running"):pt.setSessionProperties()}),a(this,"setAppVersion",function(e){i.jOyM?i.LOdw?i.version=e:Ye.warn("Apxor SDK is not running"):pt.setAppVersion()}),a(this,"yvep",function(){Ye.debug("Controller : Updating the App info");var e=i.config,t=e.name,n=void 0===t?"":t,r=e.domain,o=void 0===r?i.window.location.host:r,s=i.uWcJ.getInstallationTime(i.startTime),a=Je(i.window),u=he(i.clientConfig.version)?""+i.clientConfig.version:i.uWcJ.djnw(),c=n;""===n&&"Unknown"===(c=Ae(i.window))&&(c=""),i.LtoP=$e(c,o,s,a,u)}),a(this,"getEventCount",function(e){var t=-1;return i.clientEvents.forEach(function(n){n.name===e&&(t+=1)}),-1===t?i.fYaM.getEventCount(e):t}),a(this,"fayb",function(){i.RtXj(),i.xgHj=null}),a(this,"RtXj",function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Ye.debug("Controller : Ending the navigation"),he(i.xgHj)&&(i.xgHj.duration=De(i.getSDKRunningTimeInSec()-i.xgHj.transition_time),i.dispatchEvent(X,n({},i.xgHj),e))}),a(this,"getSessionId",function(){return i.sessionId}),a(this,"MkfT",function(){return i.jOyM?i.LOdw?i.sItP:(Ye.warn("Controller : Apxor SDK is not running"),null):(pt.getClientId(),null)}),a(this,"kMkU",function(){var e;if(i.jOyM){var t=i.mwcz(i.NnaL),n=i.siteId,r=JSON.stringify(t);(null===(e=i.NnaL)||void 0===e?void 0:e.app_events.length)>0&&(Ye.debug("Reporting a chunk on visibility change with sendBeacon"),i.uWcJ.qJWe(),i.uWcJ.hTBv(t),navigator.sendBeacon("https://server.apxor.com/v2/api/".concat(n,"/text-chunks?appId=").concat(n),r))}}),a(this,"GkfJ",function(e){if(ve(i.TExs[e])&&0!==i.TExs[e])i.TExs[e]=0;else{var t=i.TExs[e];t+=1,i.TExs[e]=t}var n=Fe(i.siteId,JSON.stringify(i.TExs));i.persistToStorage(ie,n)}),a(this,"xfBF",function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!i.jOyM||!i.LOdw)return Ye.warn("Controller : Can't log App event. SDK not initialised"),void pt.xfBF();try{if(me(e)&&Pe(t)){var s=e.replace("'","").replace("â€™","");i.GkfJ(s);var a=i.TExs[s]||0;t=n(n({},t),{},{apx_lt_count:a});var u=Qe(e,je(t),r,i.knMB()),c=Y;if(i.WYdp.includes(e))return;i.oNAi.includes(e)&&(c=V),Ye.debug("Controller : Logging event ".concat(e)),i.MBsb(e,t),i.dispatchEvent(c,u,!1,o)}else Ye.debug("Controller : Invalid App Event ".concat(e))}catch(e){Ye.error("LT Count object parsing failed ".concat(e))}}),a(this,"logClientEvent",function(e,t){if(!i.jOyM||!i.LOdw)return Ye.warn("Controller : Can't log client event. SDK not initialised"),void pt.logClientEvent();var r=i.uWcJ.getltCount(e);t=n(n({},t),{},{apx_lt_count:r});var o=Qe(e,je(t),null,i.knMB()),s=V;i.WYdp.includes(e)||(i.itzX.includes(e)&&(s=Y),o?(Ye.debug("Controller : Logging client event ".concat(e)),i.MBsb(e,t),i.dispatchEvent(s,o)):Ye.debug("Controller : Invalid client event ".concat(e)))}),a(this,"logPageView",function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.knMB();if(!i.jOyM||!i.LOdw)return Ye.warn("Controller : Can't log page event. SDK not initialised"),void pt.logPageView();if("string"==typeof e&&e&&e.length>0){var n=De(t),r=tt(e,Ae(i.window),0,n);i.fYaM.MRcz(e),he(i.xgHj)?(i.RtXj(),i.xgHj=r):i.xgHj=r,i.xfBF(z,{time:Oe(new Date),navigation_id:e}),Ye.debug("logPageView: page view is logged ",e)}else Ye.warn("Controller : Can't log page event as pathname is empty")}),a(this,"dispatchEvent",function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];Ye.debug("Controller : Dispatching Event ".concat(t.name)),i.uWcJ.updateRetainedDayCount(Date.now());var s=!1,a=function(){var a=i.NnaL.app_events;switch(s&&(t.time=i.knMB()),e){case Y:i.NnaL=n(n({},i.NnaL),{},{app_events:[].concat(a,t)});break;case V:i.clientEvents.push(t)}if(i.OfEC.enhp(e,t),!s&&e!==V){i.NnaL=n(n({},i.NnaL),{},{user_attributes:n({},i.mnUp),session_attributes:n({},i.YITg)});var u=i.mwcz(i.NnaL,e);if(i.uWcJ.OzRy(i.NnaL),i.uWcJ.hTBv(u),!0!==o)if(i.SzsO){if(a.length+1<i.yVqf)return;i.gOmp(u,r)}else r||e!==Y||i.rqjr||i.gOmp(u,r);else i.gOmp(u,r)}},u=function(){i.persistToStorage($,Date.now()),a()};if(e===Y){var c=Date.now(),l=i.getFromStorage($);l=Number(l),we(l)&&l>0&&Math.round(Me(c-l))>i.xZkT?i.endSession(!0,function(){s=!0,i.startNewSession(Date.now(),u)}):(i.persistToStorage($,Date.now()),a())}else a()}),a(this,"startNewSession",function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now(),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];i.jOyM||r?i.LOdw?n():(i.sessionId=xe(),Ye.debug("Controller : New session started with id ".concat(i.sessionId)),i.persistToStorage(ee,i.sessionId),i.MtWo=null!==(e=i.getFromStorage(Z))&&void 0!==e?e:0,i.MtWo=Number(i.MtWo)+1,i.persistToStorage(Z,i.MtWo),i.sessionStartTime=t,i.persistToStorage(se,i.sessionStartTime),i.ZPph.fABu(),i.bgml(),i.MEiE=new ft(i.config),i.LOdw=!0,i.nPoa(),n()):pt.startSession()}),a(this,"endSession",function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};if(i.jOyM)if(i.LOdw){e||i.RtXj();var r=n(n({},i.NnaL),{},{user_attributes:n({},i.mnUp),session_attributes:n({},i.YITg)}),o=i.mwcz(r);i.uWcJ.qJWe();var s=function(){i.uWcJ.oInv(),i.ZPph.fABu(),he(i.MEiE)&&i.MJGq&&i.MEiE.OwkT(),Se(document),i.LOdw=!1,t(),Ye.debug("Controller : Current session ended")};i.cDRG>0&&i.KSDx>0?(i.uWcJ.hTBv(o),s()):i.gOmp(o,!1,s)}else Ye.warn("Apxor SDK is not running. Please make sure to call 'startSession'");else pt.endSession()}),a(this,"persistToStorage",function(e,t){var n=t;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&Pe(n)&&(n=Fe(i.siteId,JSON.stringify(n))),i.uWcJ.ixJM(e,n)}),a(this,"getFromStorage",function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return i.uWcJ.getItem(e,t)}),a(this,"jZCm",function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return i.uWcJ.EFug(e,t,n)}),a(this,"fCqc",function(){return i.Imqv}),a(this,"getUserAttributes",function(){return i.mnUp}),a(this,"getSessionAttributes",function(){return i.YITg}),a(this,"makeGetRequest",function(e,t,n){i._api.makeGetRequest(e,t,n)}),a(this,"fetchConfiguration",function(e,t,n,r){i.fYaM.fetchConfiguration(e,t,n,r)}),a(this,"flattenJSON",function(e){return je(e,2)}),a(this,"registerForEvent",function(e,t){i.OfEC.registerForEvent(e,t)}),a(this,"unregisterFromEvent",function(e,t){i.OfEC.unregisterFromEvent(e,t)}),a(this,"getSDKRunningTimeInSec",function(){return Me(Date.now()-i.startTime)}),a(this,"knMB",function(){var e=Date.now();return Ye.debug("Controller : Time elapsed in session is ".concat((e-i.sessionStartTime)/1e3,"sec")),Me(e-i.sessionStartTime)}),a(this,"qcER",function(e){i.DPXt=e}),t.instance||(t.instance=this),t.instance}return s(t,null,[{key:"getInstance",value:function(){return t.instance||(t.instance=new t),t.instance}}]),t}();a(mt,"instance",void 0);var _t=s(function e(t){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ce();r(this,e),a(this,"jOyM",!1),a(this,"vXGl",[]),a(this,"version",190),a(this,"jRkZ",function(){Array.isArray(n._q)&&n._q.forEach(function(e){var t=e.m,i=e.args;n[t]&&pe(n[t])&&n[t].apply(n,Array.from(i))})}),a(this,"init",function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;try{if(Ye.debug("SDK : Apxor SDK initialization has started"),!n.jOyM){var o,s;he(t)&&(!he(t)||t instanceof Object)||(t=h);var a=t,u=a.honorDNT,c=void 0!==u&&u,l=a.debug,d=void 0!==l&&l,g=a.events_upload_time,f=void 0===g?-1:g,v=a.retry_time,p=void 0===v?-1:v,m=a.level,_=void 0===m?"error":m;if(null!==(o=n.window)&&void 0!==o&&null!==(o=o.localStorage)&&void 0!==o&&o.getItem("apx_debug_enable")&&(d="true"===n.window.localStorage.getItem("apx_debug_enable")),null!==(s=n.window)&&void 0!==s&&null!==(s=s.localStorage)&&void 0!==s&&s.getItem("apx_log_level")&&(_=n.window.localStorage.getItem("apx_log_level")),n.Dwcl(d,_),!he(e)||!he(e.trim)||""===e.trim())return Ye.error("SDK : ApxorSDK couldn't be initialized: Invalid Site Id:".concat(e)),n._controller=pt,void(null!=r&&pe(r)&&r());if(c&&!function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e.navigator){var t=e.navigator.doNotTrack;return!("1"===t||"yes"===t)}return!0}(n.window))return n._controller=pt,null!=r&&pe(r)&&r(),void Ye.error("SDK : Tracking is disabled, ApxorSDK couldn't be initialized");n._controller=mt.getInstance(),he(f)&&f>0&&(t.events_upload_time*=1e3),he(p)&&p>0&&(t.retry_time*=1e3),n._controller.initialize(e,n._startTime,t,n.window,function(){n.vXGl.forEach(function(e){var t=e.m,i=e.args;n._controller[t].apply(n._controller,Array.from(i))}),n.jOyM=!0,null!=i&&pe(i)&&(Ye.debug("SDK : Device id is "+n.getClientId()),i({client_id:n.getClientId(),session_id:n.getSessionId()})),n.window.console.info("ApxorSDK initialized for site:"+e+" with SDK version: 190")},function(){n.jOyM=!1,Ye.error("SDK : Failed to initialize Apxor SDK"),r&&pe(r)&&r("")})}}catch(e){n._controller.jOyM=!1,Ye.error("SDK : Exception while initializing Apxor SDK : ",e),r&&pe(r)&&r(e)}}),a(this,"Dwcl",function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"error";Ye.enabled=e,Ye.level=t,Ye.console=n.window.console,Ye.debug("SDK : Logger configured with level ".concat(t))}),a(this,"logEvent",function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];n.jOyM?n._controller.xfBF(e,t,void 0,i):n.vXGl.push({m:"xfBF",args:[e,t]})}),a(this,"logClientEvent",function(e,t){n.jOyM?n._controller.logClientEvent(e,t):n.vXGl.push({m:"logClientEvent",args:[e,t]})}),a(this,"logPageView",function(e){n.jOyM?n._controller.logPageView(e):n.vXGl.push({m:"logPageView",args:[e]})}),a(this,"setUserId",function(e){n.jOyM?n._controller.setUserId(e):n.vXGl.push({m:"setUserId",args:[e]})}),a(this,"setUserProperties",function(e){Ye.debug("SDK : User properties set"),n.jOyM?n._controller.setUserProperties(e):n.vXGl.push({m:"setUserProperties",args:[e]})}),a(this,"setSessionProperties",function(e){Ye.debug("SDK : Session properties set"),n.jOyM?n._controller.setSessionProperties(e):n.vXGl.push({m:"setSessionProperties",args:[e]})}),a(this,"setAppVersion",function(e){n.jOyM?n._controller.setAppVersion(e):n.vXGl.push({m:"setAppVersion",args:[e]})}),a(this,"flattenJSON",function(e){n.jOyM?n._controller.flattenJSON(e):n.vXGl.push({m:"flattenJSON",args:[e]})}),a(this,"getSessionId",function(){return n.jOyM?n._controller.getSessionId():null}),a(this,"getClientId",function(){return n._controller.MkfT()}),a(this,"startNewSession",function(){Ye.debug("SDK : A new session started"),n.jOyM?n._controller.startNewSession(Date.now()):n.vXGl.push({m:"startNewSession",args:[]})}),a(this,"endSession",function(){Ye.debug("SDK : Current session ended"),n.jOyM?n._controller.endSession():n.vXGl.push({m:"endSession",args:[]})}),a(this,"getController",function(){return n._controller}),a(this,"getSiteId",function(){var e;return null===(e=n._controller)||void 0===e?void 0:e.getSiteId()}),a(this,"setRedirectionHandler",function(e){pe(e)?n.jOyM?n._controller.setRedirectionHandler(e):n.vXGl.push({m:"setRedirectionHandler",args:[e]}):Ye.error("Callback must be a function")}),a(this,"setInitFlag",function(e){n.jOyM=e}),this.window=t,this._startTime=i,this.jRkZ()});window.Apxor=window.Apxor||{_q:[],_st:Date.now()},_t.prototype._q=window.Apxor._q;var wt=new _t(window,+window.Apxor._st);window.Apxor=wt,window.ApxorLogger=Ye;try{void 0===exports&&null===exports||(exports.default=wt,module.exports=exports.default)}catch(e){}return wt});
