!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("apxor")):"function"==typeof define&&define.amd?define(["apxor"],e):(t=t||self)["apxor-qe"]=e(t.Apxor)}(this,function(t){"use strict";function e(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function r(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?e(Object(n),!0).forEach(function(e){s(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):e(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,l(n.key),n)}}function a(t,e,r){return e&&o(t.prototype,e),r&&o(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function s(t,e,r){return(e=l(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function u(t){return function(t){if(Array.isArray(t))return c(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return c(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return c(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function l(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}t=t&&t.hasOwnProperty("default")?t.default:t;var h=function(t){return void 0!==t&&!function(t){return null===t}(t)},v="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function f(t,e){return Array.from(e).map(function(e,r){return String.fromCharCode(e^function(t,e){return t.charCodeAt(Math.floor(e%t.length))}(t,r))}).join("")}var d=function(t,e){return f(t,e=function(t){var e,r,n,i,o,a,s=0,u=[];if(!t)return t;t+="";do{e=(a=v.indexOf(t.charAt(s++))<<18|v.indexOf(t.charAt(s++))<<12|(i=v.indexOf(t.charAt(s++)))<<6|(o=v.indexOf(t.charAt(s++))))>>16&255,r=a>>8&255,n=255&a,u.push(e),64!==i&&(u.push(r),64!==o&&u.push(n))}while(s<t.length);return u}(e))},g=function(t){switch(t){case"app_event":return"AE";case"client_event":return"CE";case"activity_time":case"activity_event":return"AE"}return"Unknown"},p=function(t){return t.toUpperCase()},y=function(t,e,r){switch(r){case"EQ":return t===e;case"GT":return t>e;case"GTE":return t>=e;case"LT":return t<e;case"LTE":return t<=e;case"NEQ":return t!==e;case"R":return m(e).test(t);default:return!1}},m=function(t){var e=t.replace(/.*\/([gimuy]*)$/,"$1");e===t&&(e="");var r=e?t.replace(new RegExp("^/(.*?)/"+e+"$"),"$1"):t;return new RegExp(r,e)},b=function(){var t=new Date;return t.getDate()+"/"+t.getMonth()+"/"+t.getFullYear()},_=window.ApxorLogger,N=a(function e(){var r=this;i(this,e),s(this,"PPcA","ALL"),s(this,"VhCT",[]),s(this,"PvxZ",[]),s(this,"parse",function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(r.PPcA=t.audience.audience_type,r.VhCT=t.audience.attributes.user,r.PvxZ=t.audience.attributes.session,!Array.isArray(r.VhCT)||!Array.isArray(r.PvxZ))return _.error("No attributes"),!1}catch(t){return _.error(t),!1}return!0}),s(this,"validate",function(e,n){var i=!0;return"FTU"===r.PPcA&&(i=t.getController().getSessionInfo().is_first_session),i&&r.erKc(e,r.VhCT)&&r.erKc(n,r.PvxZ)}),s(this,"erKc",function(t,e){var r=e.length,i=!0;try{for(var o=function(){var r=e[a];if(!t[r.name]||!1===i)return{v:!1};var n=r.operator,o=r.type,s=r.value.map(function(t){return"s"===o?t:"l"===o?parseInt(t):"f"===o?parseFloat(t):void 0}),u=(Array.isArray(t[r.name])?t[r.name]:[t[r.name]]).some(function(t){return s.some(function(e){return y(t,e,n)})});i=i&&u},a=0;a<r;a++){var s=o();if("object"===n(s))return s.v}}catch(t){_.error(t),i=!1}return i})}),w=window.ApxorLogger,E=a(function t(){var e=this;i(this,t),s(this,"HUuO",0),s(this,"MmzC",0),s(this,"lxmY","SESSION"),s(this,"WuSM",0),s(this,"drqr",0),s(this,"uFaH",0),s(this,"parse",function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{e.HUuO=t.frequency.count,e.uFaH=e.HUuO,e.MmzC=t.frequency.time_interval,e.lxmY=t.frequency.validity,e.drqr=t.frequency.ses_lmt,e._dayCount=t.frequency.day_lmt;var r=V.getInstance().getQeState();if(!h(r)||!h(r[t._id]))return!0;if("SESSION"===e.lxmY){if(e.HUuO=parseInt(e.HUuO)-parseInt(r[t._id].SESSION),e.HUuO<=0)return console.warn("Max count limit reached for session:"+t._id),!1}else{if("OVERALL"!==e.lxmY)return w.info("Invalid config."),!1;if(e.HUuO=parseInt(e.HUuO)-parseInt(r[t._id].OVERALL),e.HUuO<=0)return console.warn("Max count limit reached for overall:"+t._id),!1}}catch(t){return w.error(t),!1}return!0}),s(this,"OFGE",function(){e.HUuO=e.HUuO-1}),s(this,"getFrequencyCount",function(){return e.HUuO}),s(this,"UIMO",function(){"SESSION"===e.lxmY&&(e.HUuO=e.uFaH,w.info("Campaign Limit reset"))}),s(this,"roRm",function(t){try{if(e.HUuO<=0)return!1;var r=V.getInstance().getQeState();if(!h(r)||!h(r[t]))return!0;if(0!==e.drqr)if(parseInt(e.drqr)-parseInt(r[t].SESSION)<=0)return!1;if(0!==e._dayCount){var n,i=b();if(parseInt(e._dayCount)-parseInt((null===(n=r[t])||void 0===n?void 0:n.DATES[i])||0)<=0)return!1}}catch(t){w.error("Error validating the frequency:"+t)}return!0})}),A=a(function t(){var e=this;i(this,t),s(this,"JNlq",""),s(this,"PPcA",""),s(this,"parse",function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var r;e.JNlq=t.meta.name,e.PPcA=t.meta.type,e._only_context=t.meta.only_context,e._attr=(null===(r=t.meta)||void 0===r?void 0:r.attr)||{}}catch(t){return window.ApxorLogger.error(t),!1}return!0})}),S=window.ApxorLogger,H=a(function t(){var e=this;i(this,t),s(this,"fqCr",-1),s(this,"HRCy",-1),s(this,"UOlb",-1),s(this,"ZTko",-1),s(this,"HqhE",!1),s(this,"parse",function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(isNaN(Date.parse(t.validity.start_date))||isNaN(Date.parse(t.validity.end_date)))return S.error("Not valid dates"),!1;if(e.fqCr=Date.parse(t.validity.start_date),e.HRCy=Date.parse(t.validity.end_date),h(t.time_limits_in_day)&&(e.HqhE=t.time_limits_in_day,e.HqhE&&h(t.time_limits))){var r=(new Date).toISOString().split("T")[0];if(e.UOlb=Date.parse(r+"T"+t.time_limits.start_time+".000Z"),e.ZTko=Date.parse(r+"T"+t.time_limits.end_time+".000Z"),isNaN(e.UOlb)||isNaN(e.ZTko))return S.error("Not valid times"),!1}}catch(t){return S.error(t),!1}return!0}),s(this,"validate",function(){var t=Date.now();return t>e.fqCr&&t<e.HRCy&&(!e.HqhE||t>=e.UOlb&&t<=e.ZTko)})}),C=a(function t(){var e=this;i(this,t),s(this,"JNlq",""),s(this,"NGyN",{}),s(this,"parse",function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{e.JNlq=t.name,e.NGyN=t.additional_info}catch(t){return!1}return!0})}),O=a(function t(){var e=this;i(this,t),s(this,"RgSr",0),s(this,"rhJv",0),s(this,"parse",function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(e.RgSr=Number(t.lower),e.rhJv=Number(t.upper),isNaN(e.RgSr)||isNaN(e.rhJv))return!1}catch(t){return!1}return!0})}),G=a(function t(){var e=this;i(this,t),s(this,"CyLy",0),s(this,"Crmh",""),s(this,"IGBX",""),s(this,"bNWz",new C),s(this,"tZGt",new O),s(this,"parse",function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return e.Crmh=t.event_type,e.IGBX=t.activity,e.bNWz.parse(t.details)&&e.tZGt.parse(t.time_bounds)}catch(t){return!1}})}),q=window.ApxorLogger,W=a(function t(){var e=this;i(this,t),s(this,"CyLy",0),s(this,"tXUJ",-1),s(this,"HUuO",0),s(this,"CUOs",""),s(this,"IGBX",""),s(this,"Crmh",""),s(this,"tZGt",new O),s(this,"bNWz",new C),s(this,"dcmb",new G),s(this,"GvEi","AND"),s(this,"vHaX",!1),s(this,"PPcA",void 0),s(this,"parse",function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return e.tXUJ=t.sequence,e.HUuO=t.count_config.count,e.CUOs=t.count_config.operator,e.IGBX=t.activity,e.Crmh=t.event_type,e.GvEi=t.combine_operator,e.PPcA=t.type,e.bNWz.parse(t.details)&&e.dcmb.parse(t.trigger)&&e.tZGt.parse(t.time_bounds)}catch(t){return q.error(t),!1}})}),F=window.ApxorLogger,L=a(function t(){var e=this;i(this,t),s(this,"HUuO",0),s(this,"CUOs",""),s(this,"Crmh",""),s(this,"tZGt",new O),s(this,"bNWz",new C),s(this,"GvEi","AND"),s(this,"parse",function(t){try{return e.HUuO=t.count_config.count,e.CUOs=t.count_config.operator,e.Crmh=t.event_type,e.GvEi=t.combine_operator,e.bNWz.parse(t.details)&&e.tZGt.parse(t.time_bounds)}catch(t){return F.error(t),!1}})}),R=window.ApxorLogger,x=function(){function e(){var r=this;i(this,e),s(this,"ciHZ",0),s(this,"wwbD",""),s(this,"RaHW",new W),s(this,"FKHK",new L),s(this,"vKDQ",!1),s(this,"SHGE",!1),s(this,"RsWC",0),s(this,"GvEi","AND"),s(this,"WjwU","OR"),s(this,"UAFE",-1),s(this,"rDwr",[]),s(this,"ZLHX",{}),s(this,"BvAo",!1),s(this,"initialize",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";if(r.wwbD=n,r.RsWC=i,r.rDwr=a,"termination"===s&&""!==s){r.FKHK.parse(e);return r.WjwU=r.FKHK.GvEi,r.WrZJ(),!0}if(r.RaHW.parse(e)){if(r.GvEi=r.RaHW.GvEi,r.RaHW.vHaX){var u=r.RaHW.bNWz.JNlq;"APX_PAGE_OPENED"===u&&(u=r.RaHW.bNWz.NGyN.navigation_id,u=h(u)?u:r.RaHW.bNWz.JNlq),r.UAFE=t.getController().getEventCount(u);var c=r.RaHW.HUuO,l=r.RaHW.CUOs;if(r.SHGE=r.GhAs(r.UAFE-1,c,l,!1),r.vKDQ=r.SHGE,r.SHGE&&"APX_PAGE_OPENED"===r.RaHW.bNWz.JNlq)return!0}return o&&0!==i||r.cqdx(),!0}return!1}),s(this,"cqdx",function(){var t=r.RaHW,e=t.dcmb,n=V.getInstance();"app_start"===e.Crmh?(r.vKDQ=!0,n.registerForEvent(g(t.Crmh)+"___"+t.bNWz.JNlq,r.raGt)):n.registerForEvent(g(t.Crmh)+"___"+e.bNWz.JNlq,r.raGt)}),s(this,"WrZJ",function(){var t=r.FKHK,e=V.getInstance();r.vKDQ=!0,e.registerForEvent(g(t.Crmh)+"___"+t.bNWz.JNlq,r.byxM)}),s(this,"ZHEQ",function(t,e,n,i){var o,a,s,u=(Date.now()-r.ZLHX[e])/1e3;(null===(o=r.RaHW)||void 0===o?void 0:null===(a=o.bNWz)||void 0===a?void 0:null===(s=a.NGyN)||void 0===s?void 0:s.time)/1e3>u&&r._displayCampaign(n)}),s(this,"MTFP",function(t,e,n,i){var o,a,s,u,c;r.BvAo=!0;var l=Date.now(),h=null===(o=r.RaHW)||void 0===o?void 0:null===(a=o.dcmb)||void 0===a?void 0:a.bNWz.JNlq,v=(l-r.ZLHX[h])/1e3,f=null===(s=r.RaHW)||void 0===s?void 0:null===(u=s.bNWz)||void 0===u?void 0:null===(c=u.NGyN)||void 0===c?void 0:c.time;(f/=1e3)>v&&r._displayCampaign(n)}),s(this,"raGt",function(t,e,n,i){var o=V.getInstance();if(r.vKDQ)g(r.RaHW.Crmh)===t&&r.Katg(n-r.RaHW.dcmb.CyLy,r.RaHW.tZGt)&&r.RaHW.bNWz.JNlq===e&&r.EoaT(r.RaHW.bNWz.NGyN,i)&&(r.ciHZ+=1,r.SHGE=r.GhAs(r.ciHZ,r.RaHW.HUuO,r.RaHW.CUOs),r.SHGE&&(r.RaHW.CyLy=n,o.validate(r.wwbD,r.RsWC)));else if(r.vKDQ=r.IxKh(t,e,n,i),r.vKDQ){var a=r.RaHW,s=a.dcmb;if(s.CyLy=n,"activity_time"===(null==a?void 0:a.Crmh)){var u,c,l,h,v,f,d=null==a?void 0:null===(u=a.bNWz)||void 0===u?void 0:null===(c=u.NGyN)||void 0===c?void 0:c.time;(null==a?void 0:null===(l=a.bNWz)||void 0===l?void 0:null===(h=l.NGyN)||void 0===h?void 0:h.nkpi.length)>0&&(setTimeout(function(){r.BvAo||(r.SHGE=!0,r.SHGE&&(r.ciHZ+=1,r.SHGE=r.GhAs(r.ciHZ,r.RaHW.HUuO,r.RaHW.CUOs),r.SHGE&&(r.RaHW.CyLy=n,o.validate(r.wwbD,r.RsWC)))),a.bNWz.NGyN.nkpi.map(function(t){o.unregisterFromEvent(p(a.bNWz.NGyN.et)+"___"+t,r)})},d),a.bNWz.NGyN.nkpi.map(function(t){o.registerForEvent(p(a.bNWz.NGyN.et)+"___"+t,r.MTFP)})),(null==a?void 0:null===(v=a.bNWz)||void 0===v?void 0:null===(f=v.NGyN)||void 0===f?void 0:f.kpi.length)>0&&(setTimeout(function(){a.bNWz.NGyN.kpi.map(function(t){o.unregisterFromEvent(p(a.bNWz.NGyN.et)+"___"+t,r)})},d),a.bNWz.NGyN.kpi.map(function(t){t===a.dcmb.bNWz.JNlq?(o.unregisterFromEvent(g(s.Crmh)+"___"+s.bNWz.JNlq,r),o.registerForEvent(p(a.bNWz.NGyN.et)+"___"+t,r.ZHEQ)):o.registerForEvent(p(a.bNWz.NGyN.et)+"___"+t,r.MTFP)}))}else o.unregisterFromEvent(g(s.Crmh)+"___"+s.bNWz.JNlq,r),o.registerForEvent(g(a.Crmh)+"___"+a.bNWz.JNlq,r);r.ZLHX[e]=Date.now()}}),s(this,"byxM",function(t,e,n,i){var o=V.getInstance();g(r.FKHK.Crmh)===t&&r.Katg(n,r.FKHK.tZGt)&&r.FKHK.bNWz.JNlq===e&&r.EoaT(r.FKHK.bNWz.NGyN,i)&&(r.ciHZ+=1,r.SHGE=r.GhAs(r.ciHZ,r.FKHK.HUuO,r.FKHK.CUOs),r.SHGE&&(r.FKHK.CyLy=n,o.UOFF(r.wwbD,r.RsWC)))}),s(this,"IxKh",function(t,e,n,i){var o=r.RaHW.dcmb;return g(o.Crmh)===t&&o.bNWz.JNlq===e&&r.Katg(n,o.tZGt)&&r.EoaT(o.bNWz.NGyN,i)}),s(this,"Katg",function(t,e){var r=Math.ceil(t);return r>e.RgSr&&r<e.rhJv}),s(this,"GhAs",function(t,e,n){switch((!(arguments.length>3&&void 0!==arguments[3])||arguments[3])&&r.RaHW.vHaX&&(t+=r.UAFE),n){case"EQ":return t===e;case"GT":return t>e;case"GTE":return t>=e;case"LT":return t<e;case"LTE":return t<=e;default:return!1}}),s(this,"EoaT",function(t,e){var r=!0;try{var i=function(){if(!e[o]||!1===r)return{v:!1};if("object"===n(t[o])){var i,a=t[o].op,s=t[o].t;"s"===s?i=t[o].val:"l"!==s&&"f"!==s||(i=parseFloat(t[o].val));var u=(Array.isArray(e[o])?e[o]:[e[o]]).some(function(t){return y(t,i,a)});r=r&&u}else r=r&&y(e[o],t[o],"EQ")};for(var o in t){var a=i();if("object"===n(a))return a.v}}catch(t){R.error(t),r=!1}return r})}return a(e,[{key:"_displayCampaign",value:function(t){var e=V.getInstance();this.SHGE=!0,this.SHGE&&(this.ciHZ+=1,this.SHGE=this.GhAs(this.ciHZ,this.RaHW.HUuO,this.RaHW.CUOs),this.SHGE&&(this.RaHW.CyLy=t,e.validate(this.wwbD,this.RsWC)))}}]),e}(),D="qe_state",P=window.ApxorLogger,Z=a(function e(){var r=this;i(this,e),s(this,"ArFT",[]),s(this,"_ret_day",{}),s(this,"VYBO",{}),s(this,"NfyA",!1),s(this,"exEg",!1),s(this,"parse",function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{r.ArFT=t.overall_cfg.events,r._ret_day=t.overall_cfg.ret_day,r.VYBO=t.overall_cfg.session,r.NfyA=t.overall_cfg.toggleRetDay,r.ArFT=t.overall_cfg.events,r.exEg=t.overall_cfg.toggleSession}catch(t){return P.error(t),!1}return!0}),s(this,"validate",function(){var e=parseInt(t.getController().getFromStorage("apx_retained_days")),n=parseInt(t.getController().getFromStorage("apx_retained_session"));if(r.NfyA&&!isNaN(e)&&!(e>=r._ret_day.from&&e<=r._ret_day.to))return!1;if(r.exEg&&!isNaN(n)&&!(n>=r.VYBO.from&&n<=r.VYBO.to))return!1;try{for(var i=t.getController().getFromStorage("_apx_lt_count"),o=t.getSiteId(),a=JSON.parse(d(o,i)),s=0;s<r.ArFT.length;s++){if(a[r.ArFT[s].name.replace("'","").replace("’","")])return!1}}catch(t){P.error("Failed to validate the lt count:"+t)}return!0})}),I=window.ApxorLogger,T=a(function t(){var e=this;i(this,t),s(this,"VhCT",[]),s(this,"PvxZ",[]),s(this,"parse",function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(e.VhCT=t.attributes.user,e.PvxZ=t.attributes.session,!Array.isArray(e.VhCT)||!Array.isArray(e.PvxZ))return I.error("No attributes"),!1}catch(t){return I.error(t),!1}return!0}),s(this,"validate",function(t,r){return e.erKc(t,e.VhCT)&&e.erKc(r,e.PvxZ)}),s(this,"erKc",function(t,e){var r=e.length,i=!0;try{for(var o=function(){var r=e[a];if(!t[r.name]||!1===i)return{v:!1};var n=r.operator,o=r.type,s=r.value.map(function(t){return"s"===o?t:"l"===o?parseInt(t):"f"===o?parseFloat(t):void 0}),u=(Array.isArray(t[r.name])?t[r.name]:[t[r.name]]).some(function(t){return s.some(function(e){return y(t,e,n)})});i=i&&u},a=0;a<r;a++){var s=o();if("object"===n(s))return s.v}}catch(t){I.error(t),i=!1}return i})}),z=a(function e(){var r=this;i(this,e),s(this,"eHIJ",t.getController()),s(this,"type",""),s(this,"_duration_seconds",0),s(this,"kkkb",1),s(this,"parse",function(t){try{var e,n,i;if(r.PPcA=null===(e=t.terminate_info.time_based)||void 0===e?void 0:e.type,r._duration_seconds=null===(n=t.terminate_info)||void 0===n?void 0:n.time_based.duration_seconds,r.kkkb=null===(i=t.terminate_info.time_based)||void 0===i?void 0:i.days,!r.qiJy(t._id))return!1}catch(t){return!1}return!0}),s(this,"qiJy",function(t){var e,n=JSON.parse(r.eHIJ.getFromStorage("apx_termination_ID"));if(!n[t]||null===(e=n[t])||void 0===e||!e.startDate)return!0;var i,o=new Date(n[t].startDate),a=new Date((i=new Date).getMonth()+"/"+i.getDate()+"/"+i.getFullYear());return parseInt((a-o)/864e5,10)<r.kkkb})}),U=a(function t(){var e=this;i(this,t),s(this,"enable_goal_events",!1),s(this,"attributes",{}),s(this,"AALR",new T),s(this,"time_based",{}),s(this,"mTeI",new z),s(this,"parse",function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var r,n,i;if(e.enable_time_based=null==t?void 0:null===(r=t.terminate_info)||void 0===r?void 0:r.enable_time_based,e.enable_time_based&&!e.mTeI.parse(t))return!1;if(e.enable_goal_events=null==t?void 0:null===(n=t.terminate_info)||void 0===n?void 0:n.enable_goal_events,e.enable_attributes=null==t?void 0:null===(i=t.terminate_info)||void 0===i?void 0:i.enable_attributes,e.enable_attributes&&!e.AALR.parse(t.terminate_info))return!1}catch(t){return window.ApxorLogger.error(t),!1}return!0}),s(this,"validate",function(t,r){return e.AALR.validate(t,r)})}),J=window.ApxorLogger,k=a(function e(){var n=this;i(this,e),s(this,"nOQL",[]),s(this,"zDJp",[]),s(this,"wwbD",""),s(this,"qZwL",new A),s(this,"jzoc",new N),s(this,"lxmY",new H),s(this,"Olja",new E),s(this,"yYHu",new Z),s(this,"bLlv",new U),s(this,"Tsxw",!1),s(this,"eaPb",[]),s(this,"parse",function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(!h(t._id))return J.error("No Id"),!1;if(!h(t.enabled)||!t.enabled)return J.error("Not enabled"),!1;if(!(n.qZwL.parse(t)&&n.lxmY.parse(t)&&n.Olja.parse(t)&&n.jzoc.parse(t)&&n.yYHu.parse(t)&&n.bLlv.parse(t)))return!1;if(!h(t.conditions)||!Array.isArray(t.conditions))return J.error("No valid conditions",t.conditions),!1;n.wwbD=t._id,n.Tsxw=!!h(t.sequence_enabled)&&t.sequence_enabled,n.Tsxw&&t.conditions.sort(function(t,e){return t.sequence<e.sequence});for(var e=t.conditions,r=e.length,i=0;i<r;i++){n.eaPb=[];var o=e[i];if("didn't"===o.type){var a,s,c={trigger_key:o.trigger.details.name,no_kpi_array:null==o?void 0:null===(a=o.details)||void 0===a?void 0:null===(s=a.additional_info)||void 0===s?void 0:s.nkpi,condition_id:null==o?void 0:o._id,time_bounds:o.time_bounds.upper};n.eaPb=[].concat(u(n.eaPb),[c])}var l=new x;l.initialize(o,n.wwbD,i,n.Tsxw,n.eaPb)&&n.nOQL.push(l)}if(n.bLlv.enable_goal_events)for(var v=t.terminate_info.goal_events,f=v.length,d=0;d<f;d++){var g=new x;g.initialize(v[d],n.wwbD,d,!0,[],"termination")&&n.zDJp.push(g)}return n.nOQL.length>0}catch(t){return J.error(t),!1}}),s(this,"VqPo",function(t){if(!(t<0))if(n.Tsxw){var e=n.nOQL[t];if(h(e)&&e.SHGE){var r=n.nOQL[t-1];if(h(r)&&!r.SHGE)return;var i=n.nOQL[t+1];h(i)?i.cqdx():n.gKpR()}}else n.gKpR()}),s(this,"yZzE",function(t){t<0||n.unkr()}),s(this,"gKpR",function(){var e=t.getController().getUserAttributes(),i=t.getController().getSessionAttributes();if(n.lxmY.validate()&&n.jzoc.validate(e,i)&&n.yYHu.validate()){for(var o=n.nOQL.length,a=o<1,s="",u=0;u<o;u++){var c=n.nOQL[u],l=c.SHGE;if(""===s.trim())a=l;else switch(s){case"AND":a=a&&l;break;case"OR":a=a||l}s=c.GvEi}if(a){if(console.debug("onCondition satisfied"),!n.Olja.roRm(n.wwbD))return void console.warn("Maximum limit reached",n.wwbD);console.log("Dispatching event",n.qZwL.PPcA),!0===n.qZwL._only_context&&t.logEvent("apx_context_evaluated",r(r({},n.qZwL._attr),{},{message_name:n.qZwL.JNlq,id:n.wwbD})),t.getController().dispatchEvent(n.qZwL.PPcA,{name:n.qZwL.PPcA,additional_info:{uuid:n.wwbD,name:n.qZwL.JNlq}})}}}),s(this,"unkr",function(){for(var e=n.zDJp.length,i=e<1,o="",a=0;a<e;a++){var s=n.zDJp[a],u=s.SHGE;if(""===o.trim())i=u;else switch(o){case"AND":i=i&&u;break;case"OR":i=i||u}o=s.WjwU}i&&(console.log("Dispatching event",n.qZwL.PPcA),t.getController().persistTerminationInfoLocally(n.wwbD),!0===n.qZwL._only_context&&t.logEvent("apx_context_evaluated",r(r({},n.qZwL._attr),{},{message_name:n.qZwL.JNlq,id:n.wwbD})),t.getController().dispatchEvent(n.qZwL.PPcA,{name:n.qZwL.PPcA,additional_info:{uuid:n.wwbD,name:n.qZwL.JNlq}}))}),s(this,"mgAC",function(){var e=t.getController().getUserAttributes(),r=t.getController().getSessionAttributes();return n.bLlv.validate(e,r)}),s(this,"OFGE",function(){n.Olja.OFGE()}),s(this,"getFrequencyCount",function(){return n.Olja.getFrequencyCount()}),s(this,"Hziq",function(){return n.Olja.UIMO()})}),K=a(function t(){var e=this;i(this,t),s(this,"Gpae",{}),s(this,"parse",function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{configs:[]};if(h(t)&&h(t.configs)){var r=t.configs;if(!Array.isArray(r))return;r.sort(function(t,e){var r,n;return(null!==(r=t.prio)&&void 0!==r?r:-1)-(null!==(n=e.prio)&&void 0!==n?n:-1)});for(var n=0;n<r.length;n++){var i=r[n],o=i._id,a=new k;a.parse(i)?e.Gpae[o]=a:console.warn("Failed to parse cfg",o)}}}),s(this,"validate",function(t,r){e.Gpae[t]&&e.Gpae[t].VqPo(r)}),s(this,"UOFF",function(t,r){e.Gpae[t]&&e.Gpae[t].yZzE(r)}),s(this,"mgAC",function(t){return!!e.Gpae[t]&&e.Gpae[t].mgAC()}),s(this,"OFGE",function(t){e.Gpae[t].OFGE()}),s(this,"getFrequencyCount",function(t){return e.Gpae[t].getFrequencyCount()}),s(this,"resetFrequencyCounts",function(){var t=e.Gpae;for(var r in t)t[r].Hziq()}),s(this,"TiSC",function(t){try{if(e.Gpae){var r=e.Gpae[t];if(r&&r.qZwL)return r.qZwL}}catch(t){console.log("Error in getting the campaign meta ".concat(t))}return{}})}),j=window.ApxorLogger,Q=a(function e(){var r=this;i(this,e),s(this,"bRIw",{}),s(this,"ACHx",[]),s(this,"mVmJ",!1),s(this,"initialize",function(){var e=t.getController();e.registerForEvent("APP_EVENT",function(t){return r.JeKX(t,"AE")}),e.registerForEvent("CLIENT_EVENT",function(t){return r.JeKX(t,"CE")})}),s(this,"LmEZ",function(){for(var t in r.ACHx)r.mkFq(t.event,t.key,t.type);r.mVmJ=!0}),s(this,"uuhY",function(t,e){var n;"function"==typeof e&&((n=r.bRIw[t]?r.bRIw[t]:[]).push(e),r.bRIw[t]=n,j.debug("Listeners list: ",r.bRIw))}),s(this,"unregisterFromEvent",function(t,e){if(r.bRIw[t]){for(var n=r.bRIw[t],i=[],o=0;o<n.length;o++){var a=n[o];a!==e&&i.push(a)}r.bRIw[t]=i}}),s(this,"JeKX",function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"AE",n=e+"___"+t.name;r.mkFq(t,n,e)}),s(this,"mkFq",function(e,n,i){if(r.mVmJ){if(j.debug("Notifying listeners for event: "+e+", "+n,r.bRIw),r.bRIw[n])for(var o=r.bRIw[n],a=t.getController().getSDKRunningTimeInSec(),s=0;s<o.length;s++){(0,o[s])(i,e.name,a,e.additional_info)}}else r.ACHx.push({event:e,key:n,type:i})})}),X=window.ApxorLogger,V=function(){function e(){var r=this;return i(this,e),s(this,"RzNs",!1),s(this,"XloZ",null),s(this,"WeJg",b()),s(this,"PvsE",new Q),s(this,"DKvk",t.getSiteId()),s(this,"NkhS",{}),s(this,"getQeState",function(){try{var e=t.getController().getFromStorage(D);return e?JSON.parse(d(r.DKvk,e)):(r.NkhS={},r.setQeState())}catch(t){return r.NkhS={},r.setQeState()}}),s(this,"setQeState",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";try{t.getController().persistToStorage(D,r.NkhS,!0)}catch(n){""===e?r.NkhS={}:r.NkhS[e]={SESSION:0,OVERALL:0,DATES:{}},t.getController().persistToStorage(D,r.NkhS,!0)}return r.NkhS}),s(this,"initialize",function(){r.RzNs||(r.RzNs=!0,r.XloZ=new K,r.PvsE.initialize(),r.NkhS=r.getQeState(),X.info("QE Initialized.."))}),s(this,"parse",function(t){r.cJUn()?(r.XloZ.parse(t),r.PvsE.LmEZ()):X.warn("Must call init first. Unable to proceed")}),s(this,"validate",function(t,e){r.cJUn()&&r.XloZ.validate(t,e)}),s(this,"UOFF",function(t,e){r.cJUn()&&r.XloZ.UOFF(t,e)}),s(this,"mgAC",function(t,e){return r.XloZ.mgAC(t,e)}),s(this,"updateCount",function(t){try{h(r.NkhS[t])||r.createObjConfig(t),r.incrementFrequencies(t),r.setQeState(t),r.XloZ.OFGE(t)}catch(t){console.log("Could not update the count config:".concat(t))}}),s(this,"resetFrequencyCounts",function(){r.XloZ.resetFrequencyCounts()}),s(this,"getFrequencyCount",function(t){return r.XloZ.getFrequencyCount(t)}),s(this,"registerForEvent",function(t,e){r.PvsE.uuhY(t,e)}),s(this,"unregisterFromEvent",function(t,e){r.PvsE.unregisterFromEvent(t,e)}),s(this,"fetch",function(e,r,n,i){t.getController().fetchConfiguration(e,r,n,i)}),s(this,"cJUn",function(){return r.RzNs}),s(this,"getCampaignMetaFromQueryEngine",function(t){return r.XloZ.TiSC(t)}),s(this,"hbfn",function(){return r.WeJg}),e.instance||(e.instance=this),e.instance}return a(e,[{key:"createObjConfig",value:function(t){try{this.NkhS=this.getQeState(),h(this.NkhS[t])||(this.NkhS[t]={SESSION:0,OVERALL:0,DATES:{}},this.WeJg&&(this.NkhS[t].DATES[this.WeJg]=0),this.setQeState(t))}catch(t){X.error("Can not create the frequency count object:"+t)}}},{key:"incrementFrequencies",value:function(t){this.NkhS=this.getQeState();var e=this.NkhS[t];e.SESSION=e.SESSION+1,e.OVERALL=e.OVERALL+1;var r=b();r===this.WeJg&&e.DATES&&e.DATES[r]||(this.WeJg=r,e.DATES={},e.DATES[this.WeJg]=0),e.DATES[this.WeJg]=e.DATES[this.WeJg]+1}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}();s(V,"instance",void 0),window.ceVersion=122;try{void 0===exports&&null===exports||(exports.default=V,module.exports=exports.default)}catch(t){}return V});
